<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="">

<title>reporte_prueba</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="reporte_prueba_files/libs/clipboard/clipboard.min.js"></script>
<script src="reporte_prueba_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="reporte_prueba_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="reporte_prueba_files/libs/quarto-html/popper.min.js"></script>
<script src="reporte_prueba_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="reporte_prueba_files/libs/quarto-html/anchor.min.js"></script>
<link href="reporte_prueba_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="reporte_prueba_files/libs/quarto-html/quarto-syntax-highlighting-9a88c4820ae434787121b2358194d883.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="reporte_prueba_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="reporte_prueba_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="reporte_prueba_files/libs/bootstrap/bootstrap-296634627e96efd58b230fd5814e6d3d.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<style>html{ scroll-behavior: smooth; }</style>
<link href="reporte_prueba_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="reporte_prueba_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="reporte_prueba_files/libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="reporte_prueba_files/libs/typedarray-0.1/typedarray.min.js"></script>
<script src="reporte_prueba_files/libs/jquery-3.5.1/jquery.min.js"></script>
<link href="reporte_prueba_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="reporte_prueba_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="reporte_prueba_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="reporte_prueba_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>
<link href="reporte_prueba_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="reporte_prueba_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#cargar-y-parsear-el-archivo" id="toc-cargar-y-parsear-el-archivo" class="nav-link active" data-scroll-target="#cargar-y-parsear-el-archivo">1) Cargar y parsear el archivo</a></li>
  <li><a href="#kpis-tabla-de-muestra-y-reporte-automático" id="toc-kpis-tabla-de-muestra-y-reporte-automático" class="nav-link" data-scroll-target="#kpis-tabla-de-muestra-y-reporte-automático">2) KPIs, tabla de muestra y reporte automático</a></li>
  <li><a href="#visualizaciones-plotly" id="toc-visualizaciones-plotly" class="nav-link" data-scroll-target="#visualizaciones-plotly">3) Visualizaciones (Plotly)</a>
  <ul class="collapse">
  <li><a href="#histograma-puntaje-total" id="toc-histograma-puntaje-total" class="nav-link" data-scroll-target="#histograma-puntaje-total">3.1 Histograma puntaje total</a></li>
  <li><a href="#barras-por-categoría_global" id="toc-barras-por-categoría_global" class="nav-link" data-scroll-target="#barras-por-categoría_global">3.2 Barras por categoría_global</a></li>
  <li><a href="#boxplots-por-competencia-03" id="toc-boxplots-por-competencia-03" class="nav-link" data-scroll-target="#boxplots-por-competencia-03">3.3 Boxplots por competencia (0–3)</a></li>
  <li><a href="#de-niveles-03-por-competencia" id="toc-de-niveles-03-por-competencia" class="nav-link" data-scroll-target="#de-niveles-03-por-competencia">3.4 % de niveles (0–3) por competencia</a></li>
  <li><a href="#dispersión-comp_11-vs-comp_12" id="toc-dispersión-comp_11-vs-comp_12" class="nav-link" data-scroll-target="#dispersión-comp_11-vs-comp_12">3.5 Dispersión: comp_11 vs comp_12</a></li>
  <li><a href="#radar-promedio-por-competencia-03" id="toc-radar-promedio-por-competencia-03" class="nav-link" data-scroll-target="#radar-promedio-por-competencia-03">3.6 Radar: promedio por competencia (0–3)</a></li>
  <li><a href="#de-rendición" id="toc-de-rendición" class="nav-link" data-scroll-target="#de-rendición">3.7 % de rendición</a></li>
  </ul></li>
  <li><a href="#notas" id="toc-notas" class="nav-link" data-scroll-target="#notas">4) Notas</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content"><div class="quarto-title-block"><div class="quarto-title-tools-only"><h1></h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>




<p><img src="assets/img/logo-uah-open.png" class="brand-logo img-fluid"></p>
<p class="brand-title">
<span class="brand-title-main">Análisis EPI</span> <span class="brand-title-sub">Resultados Individuales (EPI) — reporte exploratorio</span>
</p>
<p>Roberto Cantillan Carrasco</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<strong>Instrucciones</strong>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Este informe carga <strong>un único archivo Excel</strong> (ruta en <code>params$archivo</code>), lo parsea con un lector robusto y presenta métricas, tablas y visualizaciones <strong>Plotly</strong>.</p>
</div>
</div>
<section id="cargar-y-parsear-el-archivo" class="level2">
<h2 class="anchored" data-anchor-id="cargar-y-parsear-el-archivo">1) Cargar y parsear el archivo</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>archivo <span class="ot">&lt;-</span> params<span class="sc">$</span>archivo</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"WD:"</span>, <span class="fu">getwd</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>WD: /home/rober/Documentos/epi-cchh-reports </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Archivo:"</span>, archivo, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Archivo: /home/rober/Documentos/epi-cchh-reports/data/raw/BD REPORTE EPI PSICOLOGÍA.xlsx </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(archivo))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- Parser robusto ----------------</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>guess_data_start_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0){</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_double</span>(df0[[<span class="dv">1</span>]]))</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(v) <span class="sc">&amp;</span> v <span class="sc">&gt;</span> <span class="fl">1e6</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx)) <span class="fu">min</span>(idx) <span class="cf">else</span> <span class="cn">NA_integer_</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>guess_header_row_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0, data_start){</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(data_start) <span class="sc">||</span> data_start <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="cn">NA_integer_</span>)</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  prev_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df0[<span class="fu">seq_len</span>(data_start <span class="sc">-</span> <span class="dv">1</span>), , <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  nonempty <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(prev_df) <span class="sc">&amp;</span> prev_df <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(nonempty <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx)) <span class="fu">max</span>(idx) <span class="cf">else</span> <span class="cn">NA_integer_</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>make_names_from_block_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0, header_row, data_start){</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(header_row)) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    raw_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df0)</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    block <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df0[<span class="fu">seq</span>(<span class="at">from =</span> header_row, <span class="at">to =</span> data_start <span class="sc">-</span> <span class="dv">1</span>), , <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    collapse_col <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(x) <span class="sc">&amp;</span> x <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(x)) <span class="cn">NA_character_</span> <span class="cf">else</span> <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">" | "</span>)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>    raw_names <span class="ot">&lt;-</span> <span class="fu">vapply</span>(block, collapse_col, <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    empties <span class="ot">&lt;-</span> <span class="fu">is.na</span>(raw_names) <span class="sc">|</span> raw_names <span class="sc">==</span> <span class="st">""</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(empties)) {</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      idx <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(raw_names)</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      raw_names[empties] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"col_"</span>, idx[empties])</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(raw_names)</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>first_existing_col_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df, candidates){</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  keep <span class="ot">&lt;-</span> candidates[candidates <span class="sc">%in%</span> <span class="fu">names</span>(df)]</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(keep)) keep[<span class="dv">1</span>] <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>standardize_core_names <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  pats <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">rut=</span><span class="st">"(^rut(</span><span class="sc">\\</span><span class="st">s|_|$)|^rut_estudiante|^id.*estudiante)"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv=</span><span class="st">"^(dv|digito|dígito)"</span>, <span class="at">primer=</span><span class="st">"^primer.*apellido|apellid.*paterno"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">segundo=</span><span class="st">"^segundo.*apellido|apellid.*materno"</span>, <span class="at">nombres=</span><span class="st">"^nombres?$"</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">estado_hab=</span><span class="st">"^estado.*habilitaci[oó]n"</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">estatus=</span><span class="st">"^estatus.*rendici[oó]n|^estado.*rendici[oó]n"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">fecha=</span><span class="st">"^fecha.*rendici[oó]n"</span>, <span class="at">justif=</span><span class="st">"^justificaci[oó]n.*no.*rend"</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>  rename_map <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">names</span>(pats)){</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_which</span>(nms, stringr<span class="sc">::</span><span class="fu">regex</span>(pats[[k]], <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit)) {</span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>      old <span class="ot">&lt;-</span> nms[hit[<span class="dv">1</span>]]</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>      new <span class="ot">&lt;-</span> <span class="cf">switch</span>(k,</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">rut=</span><span class="st">"rut"</span>, <span class="at">dv=</span><span class="st">"dv"</span>, <span class="at">primer=</span><span class="st">"primer_apellido"</span>, <span class="at">segundo=</span><span class="st">"segundo_apellido"</span>,</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="at">nombres=</span><span class="st">"nombres"</span>, <span class="at">estado_hab=</span><span class="st">"estado_habilitacion"</span>, <span class="at">estatus=</span><span class="st">"estatus_rendicion"</span>,</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">fecha=</span><span class="st">"fecha_rendicion"</span>, <span class="at">justif=</span><span class="st">"justificacion_no_rendicion"</span></span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      rename_map[[new]] <span class="ot">&lt;-</span> old</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(rename_map)) dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(dat, <span class="sc">!!!</span>rename_map)</span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>fallback_positionals <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>  pos_map <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rut"</span>,<span class="st">"dv"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,<span class="st">"nombres"</span>,</span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>               <span class="st">"estado_habilitacion"</span>,<span class="st">"estatus_rendicion"</span>,<span class="st">"fecha_rendicion"</span>,<span class="st">"justificacion_no_rendicion"</span>)</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(pos_map)){</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>    tgt <span class="ot">&lt;-</span> pos_map[i]</span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>tgt <span class="sc">%in%</span> <span class="fu">names</span>(dat) <span class="sc">&amp;&amp;</span> i <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) <span class="fu">names</span>(dat)[i] <span class="ot">&lt;-</span> tgt</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-72"><a href="#cb6-72" aria-hidden="true" tabindex="-1"></a>looks_like_comp_score <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb6-73"><a href="#cb6-73" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(x)) <span class="fu">as.character</span>(x) <span class="cf">else</span> x</span>
<span id="cb6-74"><a href="#cb6-74" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> x2[<span class="sc">!</span><span class="fu">is.na</span>(x2) <span class="sc">&amp;</span> x2 <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb6-75"><a href="#cb6-75" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(x2)) <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb6-76"><a href="#cb6-76" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(x2, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^(nr|n</span><span class="sc">\\</span><span class="st">s*r|[0-3])$"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|</span></span>
<span id="cb6-77"><a href="#cb6-77" aria-hidden="true" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_detect</span>(x2, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}$"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-78"><a href="#cb6-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ok) <span class="sc">&gt;=</span> <span class="fl">0.7</span></span>
<span id="cb6-79"><a href="#cb6-79" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-80"><a href="#cb6-80" aria-hidden="true" tabindex="-1"></a>standardize_competencias <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb6-81"><a href="#cb6-81" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb6-82"><a href="#cb6-82" aria-hidden="true" tabindex="-1"></a>  ren <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb6-83"><a href="#cb6-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_11=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?1[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?1</span><span class="sc">\\</span><span class="st">b|distingue</span><span class="sc">\\</span><span class="st">s+las</span><span class="sc">\\</span><span class="st">s+ideas</span><span class="sc">\\</span><span class="st">s+centrales"</span>,</span>
<span id="cb6-84"><a href="#cb6-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_12=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?1[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2</span><span class="sc">\\</span><span class="st">b|explica</span><span class="sc">\\</span><span class="st">s+conceptos</span><span class="sc">\\</span><span class="st">s+te[oó]ricos?"</span>,</span>
<span id="cb6-85"><a href="#cb6-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32a=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?a</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb6-86"><a href="#cb6-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32b=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?b</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb6-87"><a href="#cb6-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32c=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?c</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb6-88"><a href="#cb6-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_41=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?4[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?1</span><span class="sc">\\</span><span class="st">b|reconoce</span><span class="sc">\\</span><span class="st">s+los</span><span class="sc">\\</span><span class="st">s+componentes"</span>,</span>
<span id="cb6-89"><a href="#cb6-89" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_42=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?4[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2</span><span class="sc">\\</span><span class="st">b|eval[íi]a</span><span class="sc">\\</span><span class="st">s+la</span><span class="sc">\\</span><span class="st">s+coherencia"</span>,</span>
<span id="cb6-90"><a href="#cb6-90" aria-hidden="true" tabindex="-1"></a>    <span class="at">puntaje_total=</span><span class="st">"puntaje.*total.*estudiante"</span>,</span>
<span id="cb6-91"><a href="#cb6-91" aria-hidden="true" tabindex="-1"></a>    <span class="at">porcentaje_logro=</span><span class="st">"porcentaje.*logro|%.*logro"</span>,</span>
<span id="cb6-92"><a href="#cb6-92" aria-hidden="true" tabindex="-1"></a>    <span class="at">categoria_global=</span><span class="st">"categor[ií]a.*resultado.*global.*estudiante"</span>,</span>
<span id="cb6-93"><a href="#cb6-93" aria-hidden="true" tabindex="-1"></a>    <span class="at">incluido_listado=</span><span class="st">"incluido.*listado"</span></span>
<span id="cb6-94"><a href="#cb6-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-95"><a href="#cb6-95" aria-hidden="true" tabindex="-1"></a>  rename_map <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb6-96"><a href="#cb6-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">names</span>(ren)){</span>
<span id="cb6-97"><a href="#cb6-97" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_which</span>(nms, stringr<span class="sc">::</span><span class="fu">regex</span>(ren[[k]], <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-98"><a href="#cb6-98" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit)) {</span>
<span id="cb6-99"><a href="#cb6-99" aria-hidden="true" tabindex="-1"></a>      old <span class="ot">&lt;-</span> nms[hit[<span class="dv">1</span>]]; rename_map[[k]] <span class="ot">&lt;-</span> old</span>
<span id="cb6-100"><a href="#cb6-100" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-101"><a href="#cb6-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-102"><a href="#cb6-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(rename_map)) dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(dat, <span class="sc">!!!</span>rename_map)</span>
<span id="cb6-103"><a href="#cb6-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-104"><a href="#cb6-104" aria-hidden="true" tabindex="-1"></a>  nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb6-105"><a href="#cb6-105" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32a"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_a"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32a"</span> }</span>
<span id="cb6-106"><a href="#cb6-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32b"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_b"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32b"</span> }</span>
<span id="cb6-107"><a href="#cb6-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32c"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_c"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32c"</span> }</span>
<span id="cb6-108"><a href="#cb6-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm; nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb6-109"><a href="#cb6-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" aria-hidden="true" tabindex="-1"></a>  idx_just <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"justificacion_no_rendicion"</span>)</span>
<span id="cb6-111"><a href="#cb6-111" aria-hidden="true" tabindex="-1"></a>  idx_32a  <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"comp_32a"</span>)</span>
<span id="cb6-112"><a href="#cb6-112" aria-hidden="true" tabindex="-1"></a>  idx_32c  <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"comp_32c"</span>)</span>
<span id="cb6-113"><a href="#cb6-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-114"><a href="#cb6-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx_just) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(idx_32a)){</span>
<span id="cb6-115"><a href="#cb6-115" aria-hidden="true" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> idx_just <span class="sc">+</span> <span class="dv">1</span>, <span class="at">to =</span> idx_32a <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb6-116"><a href="#cb6-116" aria-hidden="true" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> rng[rng <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> rng <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)]</span>
<span id="cb6-117"><a href="#cb6-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(rng)){</span>
<span id="cb6-118"><a href="#cb6-118" aria-hidden="true" tabindex="-1"></a>      cand <span class="ot">&lt;-</span> nm[rng]; mask <span class="ot">&lt;-</span> <span class="fu">vapply</span>(dat[cand], looks_like_comp_score, <span class="fu">logical</span>(<span class="dv">1</span>))</span>
<span id="cb6-119"><a href="#cb6-119" aria-hidden="true" tabindex="-1"></a>      cand2 <span class="ot">&lt;-</span> cand[mask]</span>
<span id="cb6-120"><a href="#cb6-120" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(cand2) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb6-121"><a href="#cb6-121" aria-hidden="true" tabindex="-1"></a>        nm[<span class="fu">match</span>(<span class="fu">tail</span>(cand2, <span class="dv">2</span>), nm)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>, <span class="st">"comp_12"</span>)</span>
<span id="cb6-122"><a href="#cb6-122" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(cand) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb6-123"><a href="#cb6-123" aria-hidden="true" tabindex="-1"></a>        nm[<span class="fu">match</span>(<span class="fu">tail</span>(cand, <span class="dv">2</span>), nm)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>, <span class="st">"comp_12"</span>)</span>
<span id="cb6-124"><a href="#cb6-124" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-125"><a href="#cb6-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm; nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb6-126"><a href="#cb6-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-127"><a href="#cb6-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-128"><a href="#cb6-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx_32c)){</span>
<span id="cb6-129"><a href="#cb6-129" aria-hidden="true" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> idx_32c <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb6-130"><a href="#cb6-130" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_41"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"comp_41"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb6-131"><a href="#cb6-131" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_42"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"comp_42"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb6-132"><a href="#cb6-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"puntaje_total"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"puntaje_total"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb6-133"><a href="#cb6-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"porcentaje_logro"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"porcentaje_logro"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb6-134"><a href="#cb6-134" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"categoria_global"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"categoria_global"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb6-135"><a href="#cb6-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm</span>
<span id="cb6-136"><a href="#cb6-136" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-137"><a href="#cb6-137" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb6-138"><a href="#cb6-138" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-139"><a href="#cb6-139" aria-hidden="true" tabindex="-1"></a>repair_person_names <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb6-140"><a href="#cb6-140" aria-hidden="true" tabindex="-1"></a>  required <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,<span class="st">"nombres"</span>)</span>
<span id="cb6-141"><a href="#cb6-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(required <span class="sc">%in%</span> <span class="fu">names</span>(df))) <span class="fu">return</span>(df)</span>
<span id="cb6-142"><a href="#cb6-142" aria-hidden="true" tabindex="-1"></a>  split_full <span class="ot">&lt;-</span> <span class="cf">function</span>(txt){</span>
<span id="cb6-143"><a href="#cb6-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(txt) <span class="sc">||</span> txt <span class="sc">==</span> <span class="st">""</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">nombres=</span><span class="cn">NA_character_</span>, <span class="at">ap1=</span><span class="cn">NA_character_</span>, <span class="at">ap2=</span><span class="cn">NA_character_</span>))</span>
<span id="cb6-144"><a href="#cb6-144" aria-hidden="true" tabindex="-1"></a>    toks <span class="ot">&lt;-</span> <span class="fu">str_squish</span>(txt) <span class="sc">|&gt;</span> <span class="fu">str_split</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb6-145"><a href="#cb6-145" aria-hidden="true" tabindex="-1"></a>    toks <span class="ot">&lt;-</span> toks[toks <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(toks)]</span>
<span id="cb6-146"><a href="#cb6-146" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(toks) <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">nombres=</span><span class="cn">NA_character_</span>, <span class="at">ap1=</span><span class="cn">NA_character_</span>, <span class="at">ap2=</span><span class="cn">NA_character_</span>))</span>
<span id="cb6-147"><a href="#cb6-147" aria-hidden="true" tabindex="-1"></a>    ap2 <span class="ot">&lt;-</span> toks[<span class="fu">length</span>(toks)]; ap1 <span class="ot">&lt;-</span> toks[<span class="fu">length</span>(toks)<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb6-148"><a href="#cb6-148" aria-hidden="true" tabindex="-1"></a>    nom <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(toks) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="fu">paste</span>(toks[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(toks)<span class="sc">-</span><span class="dv">2</span>)], <span class="at">collapse =</span> <span class="st">" "</span>) <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb6-149"><a href="#cb6-149" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">nombres=</span>nom, <span class="at">ap1=</span>ap1, <span class="at">ap2=</span>ap2)</span>
<span id="cb6-150"><a href="#cb6-150" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-151"><a href="#cb6-151" aria-hidden="true" tabindex="-1"></a>  need_fix <span class="ot">&lt;-</span> <span class="fu">vapply</span>(df<span class="sc">$</span>primer_apellido, <span class="cf">function</span>(x){</span>
<span id="cb6-152"><a href="#cb6-152" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(x) <span class="sc">||</span> x <span class="sc">==</span> <span class="st">""</span>) <span class="cn">FALSE</span> <span class="cf">else</span> <span class="fu">str_count</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb6-153"><a href="#cb6-153" aria-hidden="true" tabindex="-1"></a>  }, <span class="fu">logical</span>(<span class="dv">1</span>))</span>
<span id="cb6-154"><a href="#cb6-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(need_fix)){</span>
<span id="cb6-155"><a href="#cb6-155" aria-hidden="true" tabindex="-1"></a>    fixed <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df<span class="sc">$</span>primer_apellido[need_fix], split_full)</span>
<span id="cb6-156"><a href="#cb6-156" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>nombres[need_fix]          <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"nombres"</span>)</span>
<span id="cb6-157"><a href="#cb6-157" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>primer_apellido[need_fix]  <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"ap1"</span>)</span>
<span id="cb6-158"><a href="#cb6-158" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>segundo_apellido[need_fix] <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"ap2"</span>)</span>
<span id="cb6-159"><a href="#cb6-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-160"><a href="#cb6-160" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb6-161"><a href="#cb6-161" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-162"><a href="#cb6-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-163"><a href="#cb6-163" aria-hidden="true" tabindex="-1"></a>parse_resultados_individuales_v2 <span class="ot">&lt;-</span> <span class="cf">function</span>(path, <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="at">compute_total =</span> <span class="cn">TRUE</span>){</span>
<span id="cb6-164"><a href="#cb6-164" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))</span>
<span id="cb6-165"><a href="#cb6-165" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(sheet)){</span>
<span id="cb6-166"><a href="#cb6-166" aria-hidden="true" tabindex="-1"></a>    shs <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(path)</span>
<span id="cb6-167"><a href="#cb6-167" aria-hidden="true" tabindex="-1"></a>    s_low <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(shs)</span>
<span id="cb6-168"><a href="#cb6-168" aria-hidden="true" tabindex="-1"></a>    cand <span class="ot">&lt;-</span> shs[stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"resultado"</span>) <span class="sc">&amp;</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"individual"</span>)]</span>
<span id="cb6-169"><a href="#cb6-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(cand)) cand <span class="ot">&lt;-</span> shs[stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"individ"</span>)]</span>
<span id="cb6-170"><a href="#cb6-170" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(cand)) cand <span class="ot">&lt;-</span> shs</span>
<span id="cb6-171"><a href="#cb6-171" aria-hidden="true" tabindex="-1"></a>    sheet <span class="ot">&lt;-</span> cand[<span class="dv">1</span>]</span>
<span id="cb6-172"><a href="#cb6-172" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Usando hoja: "</span>, sheet)</span>
<span id="cb6-173"><a href="#cb6-173" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-174"><a href="#cb6-174" aria-hidden="true" tabindex="-1"></a>  raw <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheet, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb6-175"><a href="#cb6-175" aria-hidden="true" tabindex="-1"></a>  raw <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(raw, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">"rows"</span>,<span class="st">"cols"</span>))</span>
<span id="cb6-176"><a href="#cb6-176" aria-hidden="true" tabindex="-1"></a>  data_start <span class="ot">&lt;-</span> <span class="fu">guess_data_start_base</span>(raw)</span>
<span id="cb6-177"><a href="#cb6-177" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(data_start)) <span class="fu">stop</span>(<span class="st">"No pude detectar el inicio de datos (ID numérico) en la 1ª columna."</span>)</span>
<span id="cb6-178"><a href="#cb6-178" aria-hidden="true" tabindex="-1"></a>  hdr_row <span class="ot">&lt;-</span> <span class="fu">guess_header_row_base</span>(raw, data_start)</span>
<span id="cb6-179"><a href="#cb6-179" aria-hidden="true" tabindex="-1"></a>  col_nms <span class="ot">&lt;-</span> <span class="fu">make_names_from_block_base</span>(raw, hdr_row, data_start)</span>
<span id="cb6-180"><a href="#cb6-180" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(raw[<span class="fu">seq</span>(<span class="at">from =</span> data_start, <span class="at">to =</span> <span class="fu">nrow</span>(raw)), , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb6-181"><a href="#cb6-181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> col_nms</span>
<span id="cb6-182"><a href="#cb6-182" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">na_if</span>(.x, <span class="st">""</span>)))</span>
<span id="cb6-183"><a href="#cb6-183" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">standardize_core_names</span>(dat) <span class="sc">%&gt;%</span> <span class="fu">fallback_positionals</span>()</span>
<span id="cb6-184"><a href="#cb6-184" aria-hidden="true" tabindex="-1"></a>  id_candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"datos_de_estudiantes_de_la_cohorte"</span>, <span class="st">"rut"</span>, <span class="st">"id_estudiante"</span>, <span class="st">"id"</span>, <span class="fu">names</span>(dat)[<span class="dv">1</span>])</span>
<span id="cb6-185"><a href="#cb6-185" aria-hidden="true" tabindex="-1"></a>  id_col <span class="ot">&lt;-</span> <span class="fu">first_existing_col_base</span>(dat, id_candidates)</span>
<span id="cb6-186"><a href="#cb6-186" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id_estudiante =</span> <span class="fu">as.character</span>(.data[[id_col]]))</span>
<span id="cb6-187"><a href="#cb6-187" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">repair_person_names</span>(dat)</span>
<span id="cb6-188"><a href="#cb6-188" aria-hidden="true" tabindex="-1"></a>  has_3 <span class="ot">&lt;-</span> <span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"nombres"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(dat))</span>
<span id="cb6-189"><a href="#cb6-189" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb6-190"><a href="#cb6-190" aria-hidden="true" tabindex="-1"></a>    <span class="at">nombre_completo =</span> <span class="cf">if</span> (has_3) stringr<span class="sc">::</span><span class="fu">str_squish</span>(<span class="fu">paste</span>(nombres, primer_apellido, segundo_apellido))</span>
<span id="cb6-191"><a href="#cb6-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb6-192"><a href="#cb6-192" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb6-193"><a href="#cb6-193" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb6-194"><a href="#cb6-194" aria-hidden="true" tabindex="-1"></a>  rindio_from_fecha <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"fecha_rendicion"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)) {</span>
<span id="cb6-195"><a href="#cb6-195" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>fecha_rendicion), <span class="st">""</span>, dat<span class="sc">$</span>fecha_rendicion))</span>
<span id="cb6-196"><a href="#cb6-196" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"no</span><span class="sc">\\</span><span class="st">s*rendida"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">0</span>L,</span>
<span id="cb6-197"><a href="#cb6-197" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"rendida"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>L, <span class="cn">NA_integer_</span>))</span>
<span id="cb6-198"><a href="#cb6-198" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="fu">rep</span>(<span class="cn">NA_integer_</span>, n)</span>
<span id="cb6-199"><a href="#cb6-199" aria-hidden="true" tabindex="-1"></a>  rindio_from_estat <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"estatus_rendicion"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)) {</span>
<span id="cb6-200"><a href="#cb6-200" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>estatus_rendicion), <span class="st">""</span>, dat<span class="sc">$</span>estatus_rendicion))</span>
<span id="cb6-201"><a href="#cb6-201" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"no</span><span class="sc">\\</span><span class="st">s*rend"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">0</span>L,</span>
<span id="cb6-202"><a href="#cb6-202" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"rend"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>L, <span class="cn">NA_integer_</span>))</span>
<span id="cb6-203"><a href="#cb6-203" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="fu">rep</span>(<span class="cn">NA_integer_</span>, n)</span>
<span id="cb6-204"><a href="#cb6-204" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>rindio <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(rindio_from_fecha, rindio_from_estat)</span>
<span id="cb6-205"><a href="#cb6-205" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">standardize_competencias</span>(dat)</span>
<span id="cb6-206"><a href="#cb6-206" aria-hidden="true" tabindex="-1"></a>  comp_guess <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>,<span class="st">"comp_12"</span>,<span class="st">"comp_32a"</span>,<span class="st">"comp_32b"</span>,<span class="st">"comp_32c"</span>,<span class="st">"comp_41"</span>,<span class="st">"comp_42"</span>)</span>
<span id="cb6-207"><a href="#cb6-207" aria-hidden="true" tabindex="-1"></a>  comp_cols <span class="ot">&lt;&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(dat), comp_guess)</span>
<span id="cb6-208"><a href="#cb6-208" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(comp_cols)){</span>
<span id="cb6-209"><a href="#cb6-209" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols),</span>
<span id="cb6-210"><a href="#cb6-210" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(.x)))))</span>
<span id="cb6-211"><a href="#cb6-211" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-212"><a href="#cb6-212" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"puntaje_total"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)){</span>
<span id="cb6-213"><a href="#cb6-213" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">puntaje_total =</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(puntaje_total))))</span>
<span id="cb6-214"><a href="#cb6-214" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (compute_total <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(comp_cols)){</span>
<span id="cb6-215"><a href="#cb6-215" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">puntaje_total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb6-216"><a href="#cb6-216" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-217"><a href="#cb6-217" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"porcentaje_logro"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)){</span>
<span id="cb6-218"><a href="#cb6-218" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">porcentaje_logro =</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(porcentaje_logro)))</span>
<span id="cb6-219"><a href="#cb6-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-220"><a href="#cb6-220" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb6-221"><a href="#cb6-221" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-222"><a href="#cb6-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-223"><a href="#cb6-223" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">parse_resultados_individuales_v2</span>(archivo)</span>
<span id="cb6-224"><a href="#cb6-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-225"><a href="#cb6-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Normaliza "NR" a NA</span></span>
<span id="cb6-226"><a href="#cb6-226" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NR"</span>,<span class="st">"N R"</span>,<span class="st">"nr"</span>,<span class="st">"n r"</span>), <span class="cn">NA</span>, .x)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 211
Columns: 24
$ rut                        &lt;chr&gt; "14209461", "17346603", "18871583", "190319…
$ dv                         &lt;chr&gt; "4", "K", "4", "4", "5", "8", "1", "6", "K"…
$ primer_apellido            &lt;chr&gt; "CID", "ALTAMIRANO", "VERA", "ROJAS", "CAMP…
$ segundo_apellido           &lt;chr&gt; "REYES", "CARRASCO", "BRAVO", "MUÑOZ", "GAL…
$ nombres                    &lt;chr&gt; "PAULINA MAGDALENA", "SOFIA MAGDALENA", "DA…
$ estado_habilitacion        &lt;chr&gt; "PAULINA MAGDALENA", "SOFIA MAGDALENA", "DA…
$ estatus_rendicion          &lt;chr&gt; "Avance curricular suficiente o adecuado pa…
$ fecha_rendicion            &lt;chr&gt; "Rendida", "No rendida", "Rendida", "Rendid…
$ justificacion_no_rendicion &lt;chr&gt; "45748", NA, "45748", "45748", "45748", NA,…
$ col_10                     &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ comp_11                    &lt;dbl&gt; 2, NA, 2, 2, 3, NA, 1, 1, 3, NA, 2, 2, 2, 2…
$ comp_12                    &lt;dbl&gt; 2, NA, NA, 1, 2, NA, NA, NA, 2, NA, 2, 1, 1…
$ comp_32a                   &lt;dbl&gt; 1, NA, 3, 3, 1, NA, 0, 3, 2, NA, 3, 1, 3, N…
$ comp_32b                   &lt;dbl&gt; 2, NA, 1, 1, 2, NA, 0, 1, 1, NA, 2, 1, 2, N…
$ comp_32c                   &lt;dbl&gt; 1, NA, 1, 2, 2, NA, 0, 1, 0, NA, 1, 1, 2, N…
$ comp_41                    &lt;dbl&gt; 3, NA, 3, 3, 3, NA, 3, 3, 3, NA, 3, 3, 3, N…
$ comp_42                    &lt;dbl&gt; 3, NA, 2, 2, NA, NA, NA, NA, 0, NA, 0, 2, 2…
$ puntaje_total              &lt;dbl&gt; 14, 0, 12, 14, 13, 0, 4, 9, 11, 0, 13, 11, …
$ porcentaje_logro           &lt;dbl&gt; 0.6666667, 0.0000000, 0.5714286, 0.6666667,…
$ categoria_global           &lt;chr&gt; "No rendida o no válida", "No rendida o no …
$ incluido_listado           &lt;chr&gt; "ambos", "solo CEFAU-renuncia, abandono o e…
$ id_estudiante              &lt;chr&gt; "14209461", "17346603", "18871583", "190319…
$ nombre_completo            &lt;chr&gt; "PAULINA MAGDALENA CID REYES", "SOFIA MAGDA…
$ rindio                     &lt;int&gt; 1, 0, 1, 1, 1, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1…</code></pre>
</div>
</div>
</section>
<section id="kpis-tabla-de-muestra-y-reporte-automático" class="level2">
<h2 class="anchored" data-anchor-id="kpis-tabla-de-muestra-y-reporte-automático">2) KPIs, tabla de muestra y reporte automático</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>n_est   <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>p_rinde <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>rindio <span class="sc">%in%</span> <span class="dv">1</span>L, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>m_pt    <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>puntaje_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>p50_pt  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(dat<span class="sc">$</span>puntaje_total, <span class="fl">0.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Promedios por competencia usando nombres de columna tal cual (sin labels)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>prom_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  dat <span class="sc">|&gt;</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols), <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"prom"</span>) <span class="sc">|&gt;</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">match</span>(competencia, comp_cols))</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="fu">tibble</span>(<span class="at">competencia =</span> <span class="fu">character</span>(), <span class="at">prom =</span> <span class="fu">numeric</span>())</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>top_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(prom_comp)) prom_comp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(prom)) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>bot_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(prom_comp)) prom_comp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(prom) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)        <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">HTML</span>(glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;p&gt;&lt;b&gt;Resumen ejecutivo&lt;/b&gt;&lt;/p&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;ul&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;N estudiantes:&lt;/b&gt; {n_est}&lt;/li&gt;</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;% Rendición:&lt;/b&gt; {scales::percent(p_rinde, accuracy = 0.1)}&lt;/li&gt;</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;Puntaje total&lt;/b&gt; — media: {round(m_pt,2)}, mediana: {round(p50_pt,2)}&lt;/li&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="st">    {if (nrow(prom_comp)) glue::glue('&lt;li&gt;&lt;b&gt;Mayor promedio:&lt;/b&gt; {top_comp$competencia} ({round(top_comp$prom,2)})&lt;/li&gt;') else ''}</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="st">    {if (nrow(prom_comp)) glue::glue('&lt;li&gt;&lt;b&gt;Menor promedio:&lt;/b&gt; {bot_comp$competencia} ({round(bot_comp$prom,2)})&lt;/li&gt;') else ''}</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/ul&gt;"</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><b>Resumen ejecutivo</b></p>
<ul>
  <li><b>N estudiantes:</b> 211</li>
  <li><b>% Rendición:</b> 89.1%</li>
  <li><b>Puntaje total</b> — media: 8.23, mediana: 9</li>
  <li><b>Mayor promedio:</b> comp_41 (2.54)</li>
  <li><b>Menor promedio:</b> comp_32c (1.11)</li>
</ul>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>cols_show <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rut"</span>,<span class="st">"dv"</span>,<span class="st">"nombres"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>               <span class="st">"puntaje_total"</span>,<span class="st">"porcentaje_logro"</span>,<span class="st">"categoria_global"</span>,<span class="st">"rindio"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>cols_show <span class="ot">&lt;-</span> <span class="fu">intersect</span>(cols_show, <span class="fu">names</span>(dat))</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols_show)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"table"</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="fu">list</span>(<span class="at">values =</span> <span class="fu">names</span>(tbl), <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">color =</span> brand_accent), <span class="at">font =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"white"</span>)),</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">cells  =</span> <span class="fu">list</span>(<span class="at">values =</span> <span class="fu">lapply</span>(tbl, identity), <span class="at">align =</span> <span class="st">"left"</span>)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Muestra de registros (15)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-d418839e6a6faed706ac" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-d418839e6a6faed706ac">{"x":{"visdat":{"8c6556839acf":["function () ","plotlyVisDat"]},"cur_data":"8c6556839acf","attrs":{"8c6556839acf":{"header":{"values":["rut","dv","nombres","primer_apellido","segundo_apellido","puntaje_total","porcentaje_logro","categoria_global","rindio"],"align":"center","fill":{"color":"#19b5c6"},"font":{"color":"white"}},"cells":{"values":{"rut":["14209461","17346603","18871583","19031978","19174663","19209871","19407332","19427035","19751275","19777121","19953547","19958869","20008404","20022966","20110741"],"dv":["4","K","4","4","5","8","1","6","K","6","1","9","7","5","5"],"nombres":["PAULINA MAGDALENA","SOFIA MAGDALENA","DANIELA IGNACIA","CATALINA ESPERANZA","EILEEN IVETTE DEL","RICARDO ENRIQUE","BENJAMIN IGNACIO","ARACELI AYMARA","EDGARDO NEFTALI","JOAQUIN ESTEBAN","MARÍA DE LOS ANGELES","TOMAS CRISTOBAL","JAVIERA IGNACIA","JUAN MARTIN","MARÍA JESÚS"],"primer_apellido":["CID","ALTAMIRANO","VERA","ROJAS","CAMPO","GARCIA","TAPIA","MUÑOZ","SAEZ","FUENTES","HERNÁNDEZ","ARRIOLA","SANZANA","CHAPARRO","NÚÑEZ"],"segundo_apellido":["REYES","CARRASCO","BRAVO","MUÑOZ","GALVEZ","FLANDEZ","OYARZO","LOPEZ","MILLAPAN","MORALES","SOLÍS","PEZOA","AVILA","DIAZ","RIVAS"],"puntaje_total":[14,0,12,14,13,0,4,9,11,0,13,11,15,2,0],"porcentaje_logro":[0.66666666666666641,0,0.57142857142857162,0.66666666666666641,0.61904761904761907,0,0.19047619047619052,0.42857142857142855,0.52380952380952384,0,0.61904761904761907,0.52380952380952384,0.7142857142857143,0.095238095238095233,0],"categoria_global":["No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida"],"rindio":[1,0,1,1,1,0,1,1,1,0,1,1,1,1,1]},"align":"left"},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"table"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Muestra de registros (15)","hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"header":{"values":["rut","dv","nombres","primer_apellido","segundo_apellido","puntaje_total","porcentaje_logro","categoria_global","rindio"],"align":"center","fill":{"color":"#19b5c6"},"font":{"color":"white"}},"cells":{"values":{"rut":["14209461","17346603","18871583","19031978","19174663","19209871","19407332","19427035","19751275","19777121","19953547","19958869","20008404","20022966","20110741"],"dv":["4","K","4","4","5","8","1","6","K","6","1","9","7","5","5"],"nombres":["PAULINA MAGDALENA","SOFIA MAGDALENA","DANIELA IGNACIA","CATALINA ESPERANZA","EILEEN IVETTE DEL","RICARDO ENRIQUE","BENJAMIN IGNACIO","ARACELI AYMARA","EDGARDO NEFTALI","JOAQUIN ESTEBAN","MARÍA DE LOS ANGELES","TOMAS CRISTOBAL","JAVIERA IGNACIA","JUAN MARTIN","MARÍA JESÚS"],"primer_apellido":["CID","ALTAMIRANO","VERA","ROJAS","CAMPO","GARCIA","TAPIA","MUÑOZ","SAEZ","FUENTES","HERNÁNDEZ","ARRIOLA","SANZANA","CHAPARRO","NÚÑEZ"],"segundo_apellido":["REYES","CARRASCO","BRAVO","MUÑOZ","GALVEZ","FLANDEZ","OYARZO","LOPEZ","MILLAPAN","MORALES","SOLÍS","PEZOA","AVILA","DIAZ","RIVAS"],"puntaje_total":[14,0,12,14,13,0,4,9,11,0,13,11,15,2,0],"porcentaje_logro":[0.66666666666666641,0,0.57142857142857162,0.66666666666666641,0.61904761904761907,0,0.19047619047619052,0.42857142857142855,0.52380952380952384,0,0.61904761904761907,0.52380952380952384,0.7142857142857143,0.095238095238095233,0],"categoria_global":["No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida","No rendida o no válida"],"rindio":[1,0,1,1,1,0,1,1,1,0,1,1,1,1,1]},"align":"left"},"type":"table","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="visualizaciones-plotly" class="level2">
<h2 class="anchored" data-anchor-id="visualizaciones-plotly">3) Visualizaciones (Plotly)</h2>
<section id="histograma-puntaje-total" class="level3">
<h3 class="anchored" data-anchor-id="histograma-puntaje-total">3.1 Histograma puntaje total</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dat_p <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(puntaje_total))</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  dat_p,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>puntaje_total,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"histogram"</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbinsx =</span> <span class="dv">25</span>,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución puntaje_total"</span>,</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"puntaje_total"</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Frecuencia"</span>)</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-61ac6df13f085f93e0c8" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-61ac6df13f085f93e0c8">{"x":{"visdat":{"8c65168fefa0":["function () ","plotlyVisDat"]},"cur_data":"8c65168fefa0","attrs":{"8c65168fefa0":{"x":{},"nbinsx":25,"marker":{"line":{"width":0}},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"histogram"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución puntaje_total","xaxis":{"domain":[0,1],"automargin":true,"title":"puntaje_total"},"yaxis":{"domain":[0,1],"automargin":true,"title":"Frecuencia"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"x":[14,0,12,14,13,0,4,9,11,0,13,11,15,2,0,0,14,9,8,15,6,0,0,0,17,0,15,0,13,6,0,9,0,8,12,0,15,14,12,0,6,0,7,0,0,0,0,0,12,9,8,0,9,14,12,16,8,10,13,12,6,10,17,9,0,10,9,10,0,0,14,6,0,11,9,0,9,13,11,7,7,12,0,12,13,5,15,13,10,15,12,10,0,3,11,14,0,6,8,2,9,11,6,8,10,9,11,12,8,0,15,7,11,11,13,0,15,9,11,0,9,5,15,10,15,4,10,8,0,8,0,13,7,12,13,0,0,7,14,4,11,7,5,13,11,9,12,5,0,7,7,8,6,12,8,2,15,9,10,10,10,5,14,6,14,13,6,11,12,12,10,5,7,6,12,13,7,9,13,13,9,5,11,13,9,9,11,0,5,5,9,12,6,14,12,7,8,6,7,12,13,12,12,15,9,15,10,10,8,9,12],"nbinsx":25,"marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)","width":0}},"type":"histogram","error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="barras-por-categoría_global" class="level3">
<h3 class="anchored" data-anchor-id="barras-por-categoría_global">3.2 Barras por categoría_global</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>cat_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">categoria_global =</span> <span class="fu">fct_infreq</span>(categoria_global) <span class="sc">|&gt;</span> <span class="fu">fct_rev</span>()) <span class="sc">|&gt;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(categoria_global, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(categoria_global))</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  cat_df,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>categoria_global,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>n,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"bar"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="st">"h"</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución por categoria_global"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"N"</span>),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-ba5e6864101d79a49bb4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-ba5e6864101d79a49bb4">{"x":{"visdat":{"8c652bf0150e":["function () ","plotlyVisDat"]},"cur_data":"8c652bf0150e","attrs":{"8c652bf0150e":{"y":{},"x":{},"orientation":"h","alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución por categoria_global","xaxis":{"domain":[0,1],"automargin":true,"title":"N"},"yaxis":{"domain":[0,1],"automargin":true,"title":"","type":"category","categoryorder":"array","categoryarray":["No rendida o no válida"]},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"y":["No rendida o no válida"],"x":[190],"orientation":"h","type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="boxplots-por-competencia-03" class="level3">
<h3 class="anchored" data-anchor-id="boxplots-por-competencia-03">3.3 Boxplots por competencia (0–3)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  dat_long <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(comp_cols), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"nota"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nota)) <span class="sc">|&gt;</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols))</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>() <span class="sc">|&gt;</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dat_long,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="sc">~</span>competencia, <span class="at">y =</span> <span class="sc">~</span>nota,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"box"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">boxpoints =</span> <span class="st">"outliers"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">opacity =</span> <span class="fl">0.6</span>),</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> brand_text)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribución por competencia"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Nota (0–3)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dtick =</span> <span class="dv">1</span>)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">"&lt;em&gt;No se detectaron columnas de competencias.&lt;/em&gt;"</span>)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-7eed31e9ede8ca6b2bd4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-7eed31e9ede8ca6b2bd4">{"x":{"visdat":{"8c6552dcba61":["function () ","plotlyVisDat"],"8c6551d2134f":["function () ","data"]},"cur_data":"8c6551d2134f","attrs":{"8c6551d2134f":{"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"x":{},"y":{},"type":"box","boxpoints":"outliers","marker":{"opacity":0.59999999999999998},"line":{"color":"#11222b"},"inherit":true}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Distribución por competencia","xaxis":{"domain":[0,1],"automargin":true,"title":"","type":"category","categoryorder":"array","categoryarray":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Nota (0–3)","range":[0,3],"dtick":1},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"fillcolor":"rgba(31,119,180,0.5)","x":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_11","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_32a","comp_32b","comp_32c","comp_41","comp_42","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"y":[2,2,1,2,1,3,3,2,3,1,1,3,2,2,1,3,1,2,3,2,3,2,1,2,2,3,1,0,0,0,3,1,3,1,1,3,3,2,2,1,0,3,0,2,2,3,2,1,3,0,2,1,1,1,1,3,2,2,1,3,2,2,3,2,2,3,1,1,2,2,3,2,2,2,2,1,2,1,2,0,1,1,2,1,2,2,1,2,3,3,2,2,1,1,1,1,2,2,3,3,3,3,1,2,2,1,1,3,3,3,2,3,1,1,1,3,2,2,1,0,0,1,2,2,1,2,1,2,1,0,3,1,1,3,0,2,2,2,1,1,2,2,2,2,3,2,2,3,1,2,2,2,1,2,3,2,2,1,1,2,1,3,2,1,0,0,3,2,2,1,1,1,0,2,2,1,1,1,1,3,3,2,1,1,1,0,2,2,2,2,1,1,0,2,2,1,1,1,1,3,3,1,1,1,2,3,3,1,1,3,2,2,2,1,3,2,3,2,2,2,2,1,2,1,1,3,1,0,2,2,0,3,2,2,1,2,2,1,3,2,3,1,2,0,3,3,3,1,1,1,1,2,1,1,1,3,1,2,2,3,3,3,3,1,2,0,0,1,1,3,2,2,1,1,1,0,3,2,1,0,1,1,1,3,2,2,1,1,1,2,1,2,2,2,2,1,1,3,3,3,1,1,1,1,2,0,0,2,3,3,1,1,2,1,1,3,1,1,1,1,2,1,2,2,1,1,1,3,3,2,2,1,1,1,1,3,2,1,1,1,1,0,3,2,2,1,0,2,2,2,1,1,2,2,2,2,2,3,1,1,3,0,3,2,1,2,1,2,2,2,1,1,0,1,3,3,3,2,1,3,0,2,2,2,1,2,3,1,2,0,3,2,1,2,2,2,3,3,3,2,1,2,1,3,2,2,1,2,2,2,1,1,2,1,1,1,2,1,1,1,1,3,2,3,2,2,1,1,3,2,2,1,1,1,1,0,0,2,0,1,1,2,2,1,0,0,0,1,0,3,1,1,1,3,2,2,1,2,1,2,1,2,1,1,0,2,0,1,1,1,1,1,3,1,1,1,2,0,3,2,3,1,2,0,2,1,3,0,1,1,0,3,3,1,2,2,1,1,3,2,1,2,0,1,0,2,2,3,2,2,1,1,3,3,2,1,1,1,0,2,2,0,1,1,1,3,3,1,2,1,1,1,3,2,3,1,2,2,3,2,2,2,1,1,3,3,3,2,1,1,0,3,2,3,2,1,1,1,3,3,2,1,1,0,2,1,0,1,1,0,2,0,2,2,3,1,2,3,2,1,1,2,1,1,3,1,3,3,1,2,3,3,2,0,0,1,1,2,1,1,0,3,3,2,1,1,0,2,2,1,1,2,1,0,3,0,3,1,1,1,1,3,3,2,0,2,1,2,0,2,2,1,1,1,3,2,3,3,1,1,3,2,2,2,3,3,3,2,2,1,3,1,0,1,0,2,2,1,2,1,1,2,2,2,1,1,1,1,1,1,1,1,1,1,2,2,3,2,1,3,0,1,2,2,1,1,3,1,2,1,1,1,1,2,1,2,2,1,1,1,3,2,2,1,1,1,2,3,2,2,0,1,1,3,1,1,2,1,2,1,2,1,3,2,3,1,0,3,3,2,1,1,1,3,2,2,2,1,2,3,3,2,2,1,1,1,0,3,1,1,2,1,3,3,0,3,1,1,1,1,3,3,1,1,1,0,3,1,2,3,2,2,3,1,1,3,2,3,0,1,0,2,3,1,3,1,1,3,2,2,2,0,1,3,3,2,1,1,3,1,0,2,0,3,2,3,1,3,1,0,2,1,3,2,1,1,3,1,3,2,1,2,3,1,1,1,2,3,2,3,1,0,0,3,1,1,1,1,1,1,2,1,3,3,1,2,0,2,2,1,2,3,3,1,2,2,0,2,0,3,1,1,1,0,2,1,2,1,3,2,1,3,1,3,1,1,2,1,3,2,2,1,2,1,0,3,0,1,0,1,1,0,2,3,1,1,1,0,3,2,2,1,2,2,3,3,2,1,1,1,1,3,1,1,1,1,3,2,2,1,0,2,1,3,2,1,1,1,2,2,1,1,1,0,1,1,1,1,0,3,2,3,2,1,1,2,3,3,3,3,2,2,2,2,1,2,2,1,3,2,1,3,2,2,1,1,1,2,1,1,2,1,1,2,1,1,2,1,0,0,2,1,3,2,2,3,1,1,3,2,3,1,3,2,2,2,2,1,2,2,1,2,2,1,2,2,1,3,1,2,2,2,1,3,3,2,2,2,1,1,3,0,3,3,2,2,3,2,3,1,1,0,3,2,2,0,1,1,3,3,2,1,0,0,3,2,2,2,2,1,0,2,3,1,1,1,1,3,2],"type":"box","boxpoints":"outliers","marker":{"color":"rgba(31,119,180,1)","opacity":0.59999999999999998,"line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"#11222b"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="de-niveles-03-por-competencia" class="level3">
<h3 class="anchored" data-anchor-id="de-niveles-03-por-competencia">3.4 % de niveles (0–3) por competencia</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  dist_comp <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(comp_cols), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"nota"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">nota =</span> <span class="fu">factor</span>(nota, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(competencia, nota, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(competencia) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    dist_comp,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>competencia,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>prop,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>nota,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"bar"</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">barmode =</span> <span class="st">"stack"</span>,</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribución de niveles por competencia"</span>,</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"% dentro de competencia"</span>, <span class="at">tickformat =</span> <span class="st">".0%"</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">""</span>)</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-cfddff4facf5a34d4f2b" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cfddff4facf5a34d4f2b">{"x":{"visdat":{"8c6524967d47":["function () ","plotlyVisDat"]},"cur_data":"8c6524967d47","attrs":{"8c6524967d47":{"x":{},"y":{},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"barmode":"stack","title":"Distribución de niveles por competencia","xaxis":{"domain":[0,1],"automargin":true,"title":"","type":"category","categoryorder":"array","categoryarray":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"% dentro de competencia","tickformat":".0%"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"x":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"y":[0,0.047393364928909949,0.085308056872037921,0.042654028436018961,0.19431279620853081,0.0094786729857819912,0.080568720379146919],"type":"bar","name":"0","marker":{"color":"rgba(102,194,165,1)","line":{"color":"rgba(102,194,165,1)"}},"textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"y":[0.17535545023696683,0.26540284360189575,0.40758293838862558,0.51658767772511849,0.37440758293838861,0.07582938388625593,0.10426540284360189],"type":"bar","name":"1","marker":{"color":"rgba(252,141,98,1)","line":{"color":"rgba(252,141,98,1)"}},"textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"y":[0.45497630331753552,0.24170616113744076,0.14691943127962084,0.18009478672985782,0.13744075829383887,0.17535545023696683,0.27488151658767773],"type":"bar","name":"2","marker":{"color":"rgba(141,160,203,1)","line":{"color":"rgba(141,160,203,1)"}},"textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"y":[0.17535545023696683,0.023696682464454975,0.13744075829383887,0.037914691943127965,0.071090047393364927,0.51184834123222744,0.071090047393364927],"type":"bar","name":"3","marker":{"color":"rgba(231,138,195,1)","line":{"color":"rgba(231,138,195,1)"}},"textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="dispersión-comp_11-vs-comp_12" class="level3">
<h3 class="anchored" data-anchor-id="dispersión-comp_11-vs-comp_12">3.5 Dispersión: comp_11 vs comp_12</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"comp_11"</span>,<span class="st">"comp_12"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(dat))) {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  scat_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(comp_11), <span class="sc">!</span><span class="fu">is.na</span>(comp_12)) <span class="sc">|&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">j11 =</span> comp_11 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.05</span>),</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">j12 =</span> comp_12 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.05</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">hover =</span> <span class="fu">paste0</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;"</span>, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nombre_completo), <span class="st">"(sin nombre)"</span>, nombre_completo), <span class="st">"&lt;/b&gt;"</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;comp_11: "</span>, comp_11,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;comp_12: "</span>, comp_12,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;categoria_global: "</span>, categoria_global</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    scat_df,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>j11, <span class="at">y =</span> <span class="sc">~</span>j12,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>categoria_global,</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span>hover, <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.85</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"comp_11 vs comp_12"</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"comp_11"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">3.1</span>), <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"comp_12"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">3.1</span>), <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">"h"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.2</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">"&lt;em&gt;No están presentes simultáneamente comp_11 y comp_12.&lt;/em&gt;"</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-1e622310a725c1599b6c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-1e622310a725c1599b6c">{"x":{"visdat":{"8c6577783b04":["function () ","plotlyVisDat"]},"cur_data":"8c6577783b04","attrs":{"8c6577783b04":{"x":{},"y":{},"mode":"markers","text":{},"hoverinfo":"text","marker":{"size":7,"opacity":0.84999999999999998,"line":{"width":0}},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"comp_11 vs comp_12","xaxis":{"domain":[0,1],"automargin":true,"title":"comp_11","range":[-0.10000000000000001,3.1000000000000001],"dtick":1},"yaxis":{"domain":[0,1],"automargin":true,"title":"comp_12","range":[-0.10000000000000001,3.1000000000000001],"dtick":1},"legend":{"orientation":"h","y":-0.20000000000000001},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"x":[2.0141705132172465,1.9613844176842055,3.0088050775173856,2.982030437424279,1.9933688541946981,1.9423892452593434,1.9632269087568421,3.0753321381363206,2.0533900415419053,0.97295898345437581,1.9771102980567203,1.9636760331775167,2.0226266550693226,1.9681687618754693,2.0008226391061426,2.0123438335080537,2.0235421767961448,2.0276061962018734,1.916968316497732,1.9639793228276592,2.0544637604419917,1.989612537947226,2.0344550874529364,2.0389287521020552,1.9996741978037358,2.9278279205749729,1.0071137428626489,3.0492589069063087,1.1052575609993087,1.9587766396028772,0.9667066625484374,1.9801221554126094,2.0756228913166672,2.026546950152698,0.9605848227296041,1.9484881003423884,2.0448733104348049,0.98616898457899482,1.0562673193537424,1.0451860726959099,1.9710545684009302,2.004434984775576,1.0296457642863914,2.042568805591487,1.9561445791390155,3.0137781803454713,3.0202736652192801,1.9571851593461493,1.9718222797303149,2.0428025586011738,1.026802014100668,2.0648155530777226,1.9830130532670298,3.0012892290168836,1.9824895126493332,1.9558023593244245,1.0783052255293408,0.87054615927164769,2.9713742962785736,3.0308599560851532,1.1075419372088917,0.96178773518728267,2.9474360513860129,1.9816264246050317,1.9150842264704027,0.98828963294072025,2.0676329981769253,2.9996429995894651,3.0360498419351072,1.0419114950670909,1.9848557857300528,0.8589953728087234,0.99360786175479943,3.0064717745975305,2.030304632755473,1.9715039837609842,2.942736926377143,1.9933157992610036,1.9848383613638185,1.0177020179379983,2.0156719991285965,2.0321527291461292,2.0286263670283184,1.9312667720185335,2.0256222899728114,0.98976128220421156,3.0077029048321018,2.9822808329162354,1.9439291171647493,2.8982574244280608,1.9240043544535934,1.0206317931344662,2.9823419499446411,1.040580596337503,1.9338122408439351,1.04429129876327,2.0067882270739754,1.9726603436646792,3.0496610197552476,1.9688879546899252,2.9655769401002603,2.0008570234781224,0.93859207279436718,2.9318518942775964,2.0006338411616191,2.0331934916525225,2.0797805064642549,2.0129557576644395],"y":[1.9787369208425503,1.0482701216476735,1.8994481064925595,1.9727791677711144,2.0317472482623522,1.0103372873318532,1.010740346003959,0.88090570867435358,2.0022279640939402,2.0192681740009921,1.9441634967100525,2.0376733737348696,2.1242586827227141,3.0398301344807597,0.91237604896943192,1.0079960912099843,2.096720330177178,2.0118577390174193,1.9967654231712035,1.0457465498701297,0.94372981858281657,1.031986184477947,1.041616912926447,2.0184230549430491,1.0309671169421128,1.0824359191645285,0.97422068972107645,1.9889533599597535,0.0010901092435764317,1.0176726406598835,2.0363247844909043,2.037038460095741,0.040432040838564581,1.0502124575414988,0.051058139964604433,0.96089998509735186,1.940161187989867,2.0133984311439042,0.95698218217808728,1.0294710914990941,0.95381398007092033,1.0913085307549182,1.0610453130884727,1.9853504086343619,1.9787824242986938,1.9697696383849734,2.9803136228310545,1.9717271196545494,-0.079970830231890597,2.0226669853541361,2.0205818195470644,1.9793311576119905,1.0234387963588401,2.013978530945653,1.009422743900847,1.8841716648214566,0.98340415476464327,1.0457900154675781,0.88398855853279779,0.01649954117196448,2.0422908372334394,1.9238841164951406,1.9419943931674903,1.0095306561063893,-0.037964273312286384,1.9610841694792391,2.0296345437032364,1.9603085391435917,1.9814445249224542,-0.04169230393703547,2.0121060798248958,1.017999877976357,0.95043242977611564,0.9668665113766528,1.9698306324633064,1.9032220769726158,2.926956599549241,0.92834116994720373,2.0704780328030297,2.001567870242579,0.98167593838817524,2.0208005287663378,1.0376281248855486,1.9779617696439327,1.025539125403842,2.0498403509309746,0.9890290256602563,1.0009404612634036,2.0028043146296164,1.012040697617888,1.972350474022422,0.9875402568378554,1.0188943790573752,0.94991143744884576,3.0127759788954691,1.0321555811803711,0.97077273498706973,1.9674359301458526,0.9479766655315105,1.0706127250271196,1.0299001347678858,1.02922242127345,0.058491311238510729,0.98744560788515834,0.93665607254423899,0.96090024211980618,0.97095234733590619,1.0738544261680865],"mode":"markers","text":["<b>PAULINA MAGDALENA CID REYES<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>CATALINA ESPERANZA ROJAS MUÑOZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>EILEEN IVETTE DEL CAMPO GALVEZ<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>EDGARDO NEFTALI SAEZ MILLAPAN<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>MARÍA DE LOS ANGELES HERNÁNDEZ SOLÍS<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>TOMAS CRISTOBAL ARRIOLA PEZOA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>JAVIERA IGNACIA SANZANA AVILA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>TANYA JAVIERA CÁRCAMO OPITZ<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>MARTIN GUILLERMO MORENO CURIHUENTRO<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>ANDRÉS NICOLÁS GÓMEZ GÓMEZ<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>SOFÍA ALMENDRA PARRAGUEZ LEÓN<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JAVIERA CONSTANZA VERA CORRALES<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>CAMILO MATEO MONJE MALDONADO<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>RODRIGO ANDRÉS MARTÍNEZ MUÑOZ<\/b><br>comp_11: 2<br>comp_12: 3<br>categoria_global: No rendida o no válida","<b>FRANCISCA IGNACIA OSSES GUAJARDO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>ALONSO RUBÉN OLIVARES LANDERO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>GABRIEL IGNACIO SAAVEDRA VILLALOBOS<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>RICARDO ANDRÉS CÁCERES SALAZAR<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>VICENTE IGNACIO OLGUÍN SEPÚLVEDA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>NALLELY KRISNA ARANDA ALVARADO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CRISTIAN ELISEO CORREA RAMÍREZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>NICOLÁS AZAEL JARY POBLETE FLORES<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>JOAQUÍN ALEJANDRO INOSTROZA RECABAL<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>BENJAMÍN IGNACIO GÁLVEZ ESPINOZA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>ANTONIA SOFÍA TOLEDO RODRÍGUEZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CATALINA ISIDORA MIRANDA SERRANO<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>ENIO FABIÁN GONZÁLEZ GONZÁLEZ<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>ERIC ALEJANDRO SEPÚLVEDA ROA<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>FRANCISCA IGNACIA AZÓCAR GONZÁLEZ<\/b><br>comp_11: 1<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>FERNANDA ANTONIA HENRÍQUEZ MORENO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CATALINA TAIS MUÑOZ PARRA<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>CONAN GARAY MARAMBIO<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>AMY LILIBEL FUENTES MARTINEZ<\/b><br>comp_11: 2<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>CATALINA LUISA MARCHANT SANTIS<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>ALFONSO VICENTE ESPINOZA MONTALVA<\/b><br>comp_11: 1<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>VICENTE ANDRÉS ALARCÓN ROSENBLATT<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>TRINIDAD BRAVO AGUIAR<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>SOFÍA ISIDORA DURAND CABELLO<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>EDUARDO ANDRÉS REYES VARGAS<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CATALINA FERNANDA CARRERA LAGOS<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>MARTÍN OMAR PÉREZ GONZÁLEZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>NICOLE ANAÍS URRUTIA MELIQUEO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>EMILIA CONSTANZA MORA PAVEZ<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>BENJAMIN ANDRES ARAVENA VEGA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>MARTÍN ANDREI ÁLVAREZ ORTEGA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>BRUNO ENRIQUE CANESSA SEPÚLVEDA<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JOAQUÍN ALONSO YÁÑEZ VÁSQUEZ<\/b><br>comp_11: 3<br>comp_12: 3<br>categoria_global: No rendida o no válida","<b>CAMILO ALEJANDRO RAMÍREZ RUBILAR<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>XIMENA AMADA VALDIVIA VEGA<\/b><br>comp_11: 2<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>JESÚS AMARO TORO DURÁN<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>OMAR BENJAMÍN CASTILLO MONTERO<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>FRANCISCO JAVIER CÁRDENAS URETA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>LILIAN JUDITH VILCHES SALAZAR<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>FRANCISCO JAVIER CONRADO CARRIZO AGUIRRE<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>DANIEL ALBERTO MARTÍNEZ MORGADO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>TOMÁS MANASÉS ELIEZER ÁLVAREZ LUNA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>FERNANDA JOSEFA MARÍN ALISTE<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CAMILA ANTONIA ROMERO ESQUIVEL<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>SERGIO YURI ESCUDERO REYES<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CONSTANZA POLETT SEPÚLVEDA VERA<\/b><br>comp_11: 3<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>NICOLÁS ANDRÉS DÍAZ TORO<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>FREDDERICK UNDOMIEL VÁSQUEZ PETRONE<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>FERNANDA ANDREA SALAZAR GUZMÁN<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>CATALINA PAZ MANCILLA PÉREZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>AGUSTINA REBECA GARCÍA ABARCA<\/b><br>comp_11: 2<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>MATÍAS FRANCISCO PÉREZ BALBOA<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>BENJAMÍN RODRIGO BECERRA ORELLANA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>HEATHER ALEXIA SURANYI PROSCHLE<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>PATRICIA ANTONIA CARRASCO TORO<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>NICOLAS AGUSTIN MARTINEZ VALLADARES<\/b><br>comp_11: 1<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>MANUEL ESTEBAN GUTIÉRREZ PINTO<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>MATILDA LUZ ESCANILLA CONCHA<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>PÍA IGNACIA RAQUEL COFRÉ RAMÍREZ<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>FLORENCIA ISABEL HERNÁNDEZ MORA<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>PAULETTE DEL PILAR MONSALVE JOFRÉ<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>MÍLEN MONTALVÁN PÉREZ<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JAVIERA ANTONIA VÉLIZ MÉNDEZ<\/b><br>comp_11: 3<br>comp_12: 3<br>categoria_global: No rendida o no válida","<b>RENATO JAVIER ANABALÓN ALBORNOZ<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>VALENTINA PAZ GONZÁLEZ CAÑAS<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>VALENTINA ANTONIA SAAVEDRA CORTÉS<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>DANIELA IVETTE ALIAGA FERRADA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>GRACE CATALINA ORELLANA CASTRO<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>TRINIDAD FERNANDA ORTIZ MORENO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CATALINA TRINIDAD POLANCO ÁLVAREZ<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>GUILLERMO BENJAMÍN DONOSO QUIROGA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>FERNANDA URRUTIA URRUTIA BAHAMONDES<\/b><br>comp_11: 1<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JAVIERA VALENTINA CONSTANZA CASTRO CARVAJAL<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CONSTANZA TRINIDAD CEA FARIAS<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>MATÍAS RODRIGO JORQUERA VILLAGRA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JAVIERA OLIVIA DURÁN MOLINA<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>JAVIER IGNACIO MENDIETA GUTIÉRREZ<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>JORGE ALBERTO PEZOA RIVEROS<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>DANAE ANAÍS NAVARRETE ESPINOZA<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>LUCAS VALENTÍN ESCOBAR MEÑIQUE<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CONSTANZA ESTER ÁVILA DÍAZ<\/b><br>comp_11: 2<br>comp_12: 3<br>categoria_global: No rendida o no válida","<b>IVAN MAXIMILIANO MALDONADO PAVEZ<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>VICENTE ESTEBAN GÁLVEZ CÓRDOVA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>VALENTINA SOFÍA CASTRO ÁLVAREZ<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: No rendida o no válida","<b>NICOLÁS ALEXANDER VILLALOBOS ANCAMÁN<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CONSTANZA DENNISE SILVA MAUNA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>CATALINA ANTONIA CARREÑO TAPIA<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>VICENTE IGNACIO CANALES GAMBOA<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>EDUARDO JACINTO MATAMOROS ROJAS<\/b><br>comp_11: 1<br>comp_12: 0<br>categoria_global: No rendida o no válida","<b>PABLO ARTURO MARCO CARIAGA ROMERO<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>BENJAMÍN LUCAS TOLEDO PIZARRO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>ESTEPHANIE ALEXANDRA IBAÑEZ AMACIFUEN<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>PAOLA ELIZABETH CANELON PAREDES<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida","<b>DAPHNE ACQUARELLA MONTILLA ALVARADO<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: No rendida o no válida"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(252,141,98,1)","size":7,"opacity":0.84999999999999998,"line":{"color":"rgba(252,141,98,1)","width":0}},"type":"scatter","name":"No rendida o no válida","textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.99303481370299695,2.9800293669145055,2.8627133462713128,2.0282577061792701,1.9201759094544992,0.9542964266200552,2.0159387852784265,1.9889929874159042,1.9963594834987437,1.9181453151555412,1.8681913740519567,2.0519807679639186,2.0290434751965014,3.0273230835241249],"y":[0.96409157381589738,2.0729740638605612,2.0333918283928023,1.0192687562908243,1.0308651499467172,-0.071345178819278626,1.9300082127942118,2.9591407203072491,1.9798633143262252,1.026428301813066,2.0454237360725251,-0.037823176500391742,2.0536457423282597,1.0122285159788555],"mode":"markers","text":["<b>Pascale Aqueveque Labra<\/b><br>comp_11: 1<br>comp_12: 1<br>categoria_global: NA","<b>Maximiliano Arenas Donoso<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: NA","<b>Anahí Berríos Infantas<\/b><br>comp_11: 3<br>comp_12: 2<br>categoria_global: NA","<b>Estefanía Burgos Rojas<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: NA","<b>Florencia Cifuentes Ahumada<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: NA","<b>Thannya Espinosa Soto<\/b><br>comp_11: 1<br>comp_12: 0<br>categoria_global: NA","<b>Débora Ester González Silva<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: NA","<b>Nicolás González Vidal<\/b><br>comp_11: 2<br>comp_12: 3<br>categoria_global: NA","<b>Rocío Guzmán Candia<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: NA","<b>Pilar Ignacia Matamoros Sandoval<\/b><br>comp_11: 2<br>comp_12: 1<br>categoria_global: NA","<b>JAVIERA STEFANY NÚÑEZ RIVERA<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: NA","<b>Isidora Rojas Neyez<\/b><br>comp_11: 2<br>comp_12: 0<br>categoria_global: NA","<b>Benjamín Schnohr Carmona<\/b><br>comp_11: 2<br>comp_12: 2<br>categoria_global: NA","<b>Yavanna Vásquez Samburgo<\/b><br>comp_11: 3<br>comp_12: 1<br>categoria_global: NA"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"transparent","size":7,"opacity":0.84999999999999998,"line":{"color":"transparent","width":0}},"type":"scatter","name":"NA","textfont":{"color":"transparent"},"error_y":{"color":"transparent"},"error_x":{"color":"transparent"},"line":{"color":"transparent"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="radar-promedio-por-competencia-03" class="level3">
<h3 class="anchored" data-anchor-id="radar-promedio-por-competencia-03">3.6 Radar: promedio por competencia (0–3)</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  avg_comp <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols), <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"prom"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols)) <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(competencia)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatterpolar"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> avg_comp<span class="sc">$</span>prom,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">theta =</span> avg_comp<span class="sc">$</span>competencia,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"toself"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines+markers"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">paste0</span>(avg_comp<span class="sc">$</span>competencia, <span class="st">": "</span>, <span class="fu">round</span>(avg_comp<span class="sc">$</span>prom, <span class="dv">2</span>))</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Promedio por competencia"</span>,</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">polar =</span> <span class="fu">list</span>(<span class="at">radialaxis =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">tick0 =</span> <span class="dv">0</span>, <span class="at">dtick =</span> <span class="dv">1</span>))</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">""</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-144038467394ffc27d3c" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-144038467394ffc27d3c">{"x":{"visdat":{"8c6514f1b96a":["function () ","plotlyVisDat"]},"cur_data":"8c6514f1b96a","attrs":{"8c6514f1b96a":{"r":[2,1.4180327868852458,1.4329268292682926,1.274390243902439,1.1097560975609757,2.5398773006134969,1.6339285714285714],"theta":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"fill":"toself","mode":"lines+markers","hoverinfo":"text","text":["comp_11: 2","comp_12: 1.42","comp_32a: 1.43","comp_32b: 1.27","comp_32c: 1.11","comp_41: 2.54","comp_42: 1.63"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatterpolar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"Promedio por competencia","polar":{"radialaxis":{"visible":true,"range":[0,3],"tick0":0,"dtick":1}},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"fillcolor":"rgba(31,119,180,0.5)","r":[2,1.4180327868852458,1.4329268292682926,1.274390243902439,1.1097560975609757,2.5398773006134969,1.6339285714285714],"theta":["comp_11","comp_12","comp_32a","comp_32b","comp_32c","comp_41","comp_42"],"fill":"toself","mode":"lines+markers","hoverinfo":["text","text","text","text","text","text","text"],"text":["comp_11: 2","comp_12: 1.42","comp_32a: 1.43","comp_32b: 1.27","comp_32c: 1.11","comp_41: 2.54","comp_42: 1.63"],"type":"scatterpolar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"line":{"color":"rgba(31,119,180,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="de-rendición" class="level3">
<h3 class="anchored" data-anchor-id="de-rendición">3.7 % de rendición</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>rin_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rindio =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(rindio <span class="sc">%in%</span> <span class="dv">1</span>L, <span class="st">"Rindió"</span>, <span class="st">"No rindió"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rindio) <span class="sc">|&gt;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(rin_df, <span class="at">x =</span> <span class="sc">~</span>rindio, <span class="at">y =</span> <span class="sc">~</span>prop, <span class="at">type =</span> <span class="st">"bar"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"% de rendición"</span>,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Porcentaje"</span>, <span class="at">tickformat =</span> <span class="st">".0%"</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-4cad50cd6b3f0e0ec06d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-4cad50cd6b3f0e0ec06d">{"x":{"visdat":{"8c654054c64":["function () ","plotlyVisDat"]},"cur_data":"8c654054c64","attrs":{"8c654054c64":{"x":{},"y":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"bar"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"% de rendición","xaxis":{"domain":[0,1],"automargin":true,"title":"","type":"category","categoryorder":"array","categoryarray":["No rindió","Rindió"]},"yaxis":{"domain":[0,1],"automargin":true,"title":"Porcentaje","tickformat":".0%"},"hovermode":"closest","showlegend":false},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false,"displaylogo":false,"modeBarButtonsToRemove":["lasso2d","select2d"]},"data":[{"x":["No rindió","Rindió"],"y":[0.10900473933649289,0.89099526066350709],"type":"bar","marker":{"color":"rgba(31,119,180,1)","line":{"color":"rgba(31,119,180,1)"}},"error_y":{"color":"rgba(31,119,180,1)"},"error_x":{"color":"rgba(31,119,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
</section>
<section id="notas" class="level2">
<h2 class="anchored" data-anchor-id="notas">4) Notas</h2>
<ul>
<li>Los nombres de ejes/leyendas usan <strong>directamente los nombres de columnas</strong> (<code>comp_11</code>, <code>comp_12</code>, etc.).</li>
<li>Si cambian nombres de columnas en otro Excel, el parser intenta normalizar; si no existen, esas gráficas se omiten con un aviso breve.</li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<div class="brand-footer">
  <div class="brand-footer-wrap">
    <div>UAH · Equipo EPI</div>
    <div><a href="https://ejemplo.com">Repositorio</a></div>
    <div>© 2025 · Versión exploratoria</div>
  </div>
</div>

<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb18" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> ""</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> ""</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> ""</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="an">params:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="co">  archivo:</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co">    value: "/home/rober/Documentos/epi-cchh-reports/data/raw/BD REPORTE EPI PSICOLOGÍA.xlsx"</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="co">    label: "Archivo Excel (Resultados Individuales)"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: false</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: styles/report.scss</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="co">    title-block-banner: false</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="co">    smooth-scroll: true</span></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co">    include-after-body: _footer.html</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a><span class="co">  freeze: auto</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a><span class="co">  echo: true</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a><span class="al">![](assets/img/logo-uah-open.png)</span>{.brand-logo}</span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">p</span><span class="ot"> class</span><span class="op">=</span><span class="st">"brand-title"</span><span class="dt">&gt;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"brand-title-main"</span><span class="dt">&gt;</span>Análisis EPI<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">span</span><span class="ot"> class</span><span class="op">=</span><span class="st">"brand-title-sub"</span><span class="dt">&gt;</span>Resultados Individuales (EPI) — reporte exploratorio<span class="dt">&lt;/</span><span class="kw">span</span><span class="dt">&gt;</span></span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>Roberto Cantillan Carrasco</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>::: {.callout-note}</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a><span class="fu"># **Instrucciones**</span></span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a>Este informe carga **un único archivo Excel** (ruta en `params$archivo`), lo parsea con un lector robusto y presenta métricas, tablas y visualizaciones **Plotly**.</span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup, include=FALSE}</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">requireNamespace</span>(<span class="st">"pacman"</span>, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) <span class="fu">install.packages</span>(<span class="st">"pacman"</span>)</span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  tidyverse, readxl, janitor, readr, forcats,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  plotly, htmlwidgets, scales, htmltools, glue</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleta UAH</span></span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>brand_main   <span class="ot">&lt;-</span> <span class="st">"#0a6d7c"</span></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>brand_dark   <span class="ot">&lt;-</span> <span class="st">"#0a4e58"</span></span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>brand_accent <span class="ot">&lt;-</span> <span class="st">"#19b5c6"</span></span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>brand_text   <span class="ot">&lt;-</span> <span class="st">"#11222b"</span></span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>brand_muted  <span class="ot">&lt;-</span> <span class="st">"#4b5661"</span></span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a>brand_palette  <span class="ot">&lt;-</span> grDevices<span class="sc">::</span><span class="fu">colorRampPalette</span>(<span class="fu">c</span>(brand_accent, brand_main, brand_dark, brand_accent))</span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a>brand_discrete <span class="ot">&lt;-</span> <span class="fu">brand_palette</span>(<span class="dv">16</span>)</span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>plotly_brand <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">colorway =</span> brand_discrete, <span class="at">font =</span> <span class="fu">list</span>(<span class="at">family =</span> <span class="st">"Inconsolata"</span>))</span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>, <span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-57"><a href="#cb18-57" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-58"><a href="#cb18-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-59"><a href="#cb18-59" aria-hidden="true" tabindex="-1"></a><span class="fu">## 1) Cargar y parsear el archivo</span></span>
<span id="cb18-60"><a href="#cb18-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-61"><a href="#cb18-61" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load}</span></span>
<span id="cb18-62"><a href="#cb18-62" aria-hidden="true" tabindex="-1"></a>archivo <span class="ot">&lt;-</span> params<span class="sc">$</span>archivo</span>
<span id="cb18-63"><a href="#cb18-63" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"WD:"</span>, <span class="fu">getwd</span>(), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-64"><a href="#cb18-64" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Archivo:"</span>, archivo, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb18-65"><a href="#cb18-65" aria-hidden="true" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(archivo))</span>
<span id="cb18-66"><a href="#cb18-66" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-67"><a href="#cb18-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-68"><a href="#cb18-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r parser}</span></span>
<span id="cb18-69"><a href="#cb18-69" aria-hidden="true" tabindex="-1"></a><span class="co"># ---------------- Parser robusto ----------------</span></span>
<span id="cb18-70"><a href="#cb18-70" aria-hidden="true" tabindex="-1"></a>guess_data_start_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0){</span>
<span id="cb18-71"><a href="#cb18-71" aria-hidden="true" tabindex="-1"></a>  v <span class="ot">&lt;-</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_double</span>(df0[[<span class="dv">1</span>]]))</span>
<span id="cb18-72"><a href="#cb18-72" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(v) <span class="sc">&amp;</span> v <span class="sc">&gt;</span> <span class="fl">1e6</span>)</span>
<span id="cb18-73"><a href="#cb18-73" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx)) <span class="fu">min</span>(idx) <span class="cf">else</span> <span class="cn">NA_integer_</span></span>
<span id="cb18-74"><a href="#cb18-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-75"><a href="#cb18-75" aria-hidden="true" tabindex="-1"></a>guess_header_row_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0, data_start){</span>
<span id="cb18-76"><a href="#cb18-76" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(data_start) <span class="sc">||</span> data_start <span class="sc">&lt;=</span> <span class="dv">1</span>) <span class="fu">return</span>(<span class="cn">NA_integer_</span>)</span>
<span id="cb18-77"><a href="#cb18-77" aria-hidden="true" tabindex="-1"></a>  prev_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df0[<span class="fu">seq_len</span>(data_start <span class="sc">-</span> <span class="dv">1</span>), , <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-78"><a href="#cb18-78" aria-hidden="true" tabindex="-1"></a>  nonempty <span class="ot">&lt;-</span> <span class="fu">rowSums</span>(<span class="sc">!</span><span class="fu">is.na</span>(prev_df) <span class="sc">&amp;</span> prev_df <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb18-79"><a href="#cb18-79" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">which</span>(nonempty <span class="sc">&gt;=</span> <span class="dv">2</span>)</span>
<span id="cb18-80"><a href="#cb18-80" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx)) <span class="fu">max</span>(idx) <span class="cf">else</span> <span class="cn">NA_integer_</span></span>
<span id="cb18-81"><a href="#cb18-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-82"><a href="#cb18-82" aria-hidden="true" tabindex="-1"></a>make_names_from_block_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df0, header_row, data_start){</span>
<span id="cb18-83"><a href="#cb18-83" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(header_row)) {</span>
<span id="cb18-84"><a href="#cb18-84" aria-hidden="true" tabindex="-1"></a>    raw_names <span class="ot">&lt;-</span> <span class="fu">names</span>(df0)</span>
<span id="cb18-85"><a href="#cb18-85" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb18-86"><a href="#cb18-86" aria-hidden="true" tabindex="-1"></a>    block <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(df0[<span class="fu">seq</span>(<span class="at">from =</span> header_row, <span class="at">to =</span> data_start <span class="sc">-</span> <span class="dv">1</span>), , <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb18-87"><a href="#cb18-87" aria-hidden="true" tabindex="-1"></a>                           <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb18-88"><a href="#cb18-88" aria-hidden="true" tabindex="-1"></a>    collapse_col <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb18-89"><a href="#cb18-89" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(x) <span class="sc">&amp;</span> x <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb18-90"><a href="#cb18-90" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(x)) <span class="cn">NA_character_</span> <span class="cf">else</span> <span class="fu">paste</span>(x, <span class="at">collapse =</span> <span class="st">" | "</span>)</span>
<span id="cb18-91"><a href="#cb18-91" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-92"><a href="#cb18-92" aria-hidden="true" tabindex="-1"></a>    raw_names <span class="ot">&lt;-</span> <span class="fu">vapply</span>(block, collapse_col, <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb18-93"><a href="#cb18-93" aria-hidden="true" tabindex="-1"></a>    empties <span class="ot">&lt;-</span> <span class="fu">is.na</span>(raw_names) <span class="sc">|</span> raw_names <span class="sc">==</span> <span class="st">""</span></span>
<span id="cb18-94"><a href="#cb18-94" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">any</span>(empties)) {</span>
<span id="cb18-95"><a href="#cb18-95" aria-hidden="true" tabindex="-1"></a>      idx <span class="ot">&lt;-</span> <span class="fu">seq_along</span>(raw_names)</span>
<span id="cb18-96"><a href="#cb18-96" aria-hidden="true" tabindex="-1"></a>      raw_names[empties] <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"col_"</span>, idx[empties])</span>
<span id="cb18-97"><a href="#cb18-97" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-98"><a href="#cb18-98" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-99"><a href="#cb18-99" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">make_clean_names</span>(raw_names)</span>
<span id="cb18-100"><a href="#cb18-100" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-101"><a href="#cb18-101" aria-hidden="true" tabindex="-1"></a>first_existing_col_base <span class="ot">&lt;-</span> <span class="cf">function</span>(df, candidates){</span>
<span id="cb18-102"><a href="#cb18-102" aria-hidden="true" tabindex="-1"></a>  keep <span class="ot">&lt;-</span> candidates[candidates <span class="sc">%in%</span> <span class="fu">names</span>(df)]</span>
<span id="cb18-103"><a href="#cb18-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(keep)) keep[<span class="dv">1</span>] <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb18-104"><a href="#cb18-104" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-105"><a href="#cb18-105" aria-hidden="true" tabindex="-1"></a>standardize_core_names <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb18-106"><a href="#cb18-106" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb18-107"><a href="#cb18-107" aria-hidden="true" tabindex="-1"></a>  pats <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-108"><a href="#cb18-108" aria-hidden="true" tabindex="-1"></a>    <span class="at">rut=</span><span class="st">"(^rut(</span><span class="sc">\\</span><span class="st">s|_|$)|^rut_estudiante|^id.*estudiante)"</span>,</span>
<span id="cb18-109"><a href="#cb18-109" aria-hidden="true" tabindex="-1"></a>    <span class="at">dv=</span><span class="st">"^(dv|digito|dígito)"</span>, <span class="at">primer=</span><span class="st">"^primer.*apellido|apellid.*paterno"</span>,</span>
<span id="cb18-110"><a href="#cb18-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">segundo=</span><span class="st">"^segundo.*apellido|apellid.*materno"</span>, <span class="at">nombres=</span><span class="st">"^nombres?$"</span>,</span>
<span id="cb18-111"><a href="#cb18-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">estado_hab=</span><span class="st">"^estado.*habilitaci[oó]n"</span>,</span>
<span id="cb18-112"><a href="#cb18-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">estatus=</span><span class="st">"^estatus.*rendici[oó]n|^estado.*rendici[oó]n"</span>,</span>
<span id="cb18-113"><a href="#cb18-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">fecha=</span><span class="st">"^fecha.*rendici[oó]n"</span>, <span class="at">justif=</span><span class="st">"^justificaci[oó]n.*no.*rend"</span></span>
<span id="cb18-114"><a href="#cb18-114" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-115"><a href="#cb18-115" aria-hidden="true" tabindex="-1"></a>  rename_map <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-116"><a href="#cb18-116" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">names</span>(pats)){</span>
<span id="cb18-117"><a href="#cb18-117" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_which</span>(nms, stringr<span class="sc">::</span><span class="fu">regex</span>(pats[[k]], <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-118"><a href="#cb18-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit)) {</span>
<span id="cb18-119"><a href="#cb18-119" aria-hidden="true" tabindex="-1"></a>      old <span class="ot">&lt;-</span> nms[hit[<span class="dv">1</span>]]</span>
<span id="cb18-120"><a href="#cb18-120" aria-hidden="true" tabindex="-1"></a>      new <span class="ot">&lt;-</span> <span class="cf">switch</span>(k,</span>
<span id="cb18-121"><a href="#cb18-121" aria-hidden="true" tabindex="-1"></a>        <span class="at">rut=</span><span class="st">"rut"</span>, <span class="at">dv=</span><span class="st">"dv"</span>, <span class="at">primer=</span><span class="st">"primer_apellido"</span>, <span class="at">segundo=</span><span class="st">"segundo_apellido"</span>,</span>
<span id="cb18-122"><a href="#cb18-122" aria-hidden="true" tabindex="-1"></a>        <span class="at">nombres=</span><span class="st">"nombres"</span>, <span class="at">estado_hab=</span><span class="st">"estado_habilitacion"</span>, <span class="at">estatus=</span><span class="st">"estatus_rendicion"</span>,</span>
<span id="cb18-123"><a href="#cb18-123" aria-hidden="true" tabindex="-1"></a>        <span class="at">fecha=</span><span class="st">"fecha_rendicion"</span>, <span class="at">justif=</span><span class="st">"justificacion_no_rendicion"</span></span>
<span id="cb18-124"><a href="#cb18-124" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb18-125"><a href="#cb18-125" aria-hidden="true" tabindex="-1"></a>      rename_map[[new]] <span class="ot">&lt;-</span> old</span>
<span id="cb18-126"><a href="#cb18-126" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-127"><a href="#cb18-127" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-128"><a href="#cb18-128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(rename_map)) dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(dat, <span class="sc">!!!</span>rename_map)</span>
<span id="cb18-129"><a href="#cb18-129" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb18-130"><a href="#cb18-130" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-131"><a href="#cb18-131" aria-hidden="true" tabindex="-1"></a>fallback_positionals <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb18-132"><a href="#cb18-132" aria-hidden="true" tabindex="-1"></a>  pos_map <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rut"</span>,<span class="st">"dv"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,<span class="st">"nombres"</span>,</span>
<span id="cb18-133"><a href="#cb18-133" aria-hidden="true" tabindex="-1"></a>               <span class="st">"estado_habilitacion"</span>,<span class="st">"estatus_rendicion"</span>,<span class="st">"fecha_rendicion"</span>,<span class="st">"justificacion_no_rendicion"</span>)</span>
<span id="cb18-134"><a href="#cb18-134" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(pos_map)){</span>
<span id="cb18-135"><a href="#cb18-135" aria-hidden="true" tabindex="-1"></a>    tgt <span class="ot">&lt;-</span> pos_map[i]</span>
<span id="cb18-136"><a href="#cb18-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span>tgt <span class="sc">%in%</span> <span class="fu">names</span>(dat) <span class="sc">&amp;&amp;</span> i <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) <span class="fu">names</span>(dat)[i] <span class="ot">&lt;-</span> tgt</span>
<span id="cb18-137"><a href="#cb18-137" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-138"><a href="#cb18-138" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb18-139"><a href="#cb18-139" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-140"><a href="#cb18-140" aria-hidden="true" tabindex="-1"></a>looks_like_comp_score <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb18-141"><a href="#cb18-141" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(x)) <span class="fu">as.character</span>(x) <span class="cf">else</span> x</span>
<span id="cb18-142"><a href="#cb18-142" aria-hidden="true" tabindex="-1"></a>  x2 <span class="ot">&lt;-</span> x2[<span class="sc">!</span><span class="fu">is.na</span>(x2) <span class="sc">&amp;</span> x2 <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb18-143"><a href="#cb18-143" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(x2)) <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb18-144"><a href="#cb18-144" aria-hidden="true" tabindex="-1"></a>  ok <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(x2, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^(nr|n</span><span class="sc">\\</span><span class="st">s*r|[0-3])$"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)) <span class="sc">|</span></span>
<span id="cb18-145"><a href="#cb18-145" aria-hidden="true" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_detect</span>(x2, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">d{1,2}$"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-146"><a href="#cb18-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ok) <span class="sc">&gt;=</span> <span class="fl">0.7</span></span>
<span id="cb18-147"><a href="#cb18-147" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-148"><a href="#cb18-148" aria-hidden="true" tabindex="-1"></a>standardize_competencias <span class="ot">&lt;-</span> <span class="cf">function</span>(dat){</span>
<span id="cb18-149"><a href="#cb18-149" aria-hidden="true" tabindex="-1"></a>  nms <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb18-150"><a href="#cb18-150" aria-hidden="true" tabindex="-1"></a>  ren <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb18-151"><a href="#cb18-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_11=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?1[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?1</span><span class="sc">\\</span><span class="st">b|distingue</span><span class="sc">\\</span><span class="st">s+las</span><span class="sc">\\</span><span class="st">s+ideas</span><span class="sc">\\</span><span class="st">s+centrales"</span>,</span>
<span id="cb18-152"><a href="#cb18-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_12=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?1[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2</span><span class="sc">\\</span><span class="st">b|explica</span><span class="sc">\\</span><span class="st">s+conceptos</span><span class="sc">\\</span><span class="st">s+te[oó]ricos?"</span>,</span>
<span id="cb18-153"><a href="#cb18-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32a=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?a</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb18-154"><a href="#cb18-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32b=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?b</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb18-155"><a href="#cb18-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_32c=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?3[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?c</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb18-156"><a href="#cb18-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_41=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?4[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?1</span><span class="sc">\\</span><span class="st">b|reconoce</span><span class="sc">\\</span><span class="st">s+los</span><span class="sc">\\</span><span class="st">s+componentes"</span>,</span>
<span id="cb18-157"><a href="#cb18-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">comp_42=</span><span class="st">"^(x</span><span class="sc">\\</span><span class="st">s*)?4[</span><span class="sc">\\</span><span class="st">._</span><span class="sc">\\</span><span class="st">- ]?2</span><span class="sc">\\</span><span class="st">b|eval[íi]a</span><span class="sc">\\</span><span class="st">s+la</span><span class="sc">\\</span><span class="st">s+coherencia"</span>,</span>
<span id="cb18-158"><a href="#cb18-158" aria-hidden="true" tabindex="-1"></a>    <span class="at">puntaje_total=</span><span class="st">"puntaje.*total.*estudiante"</span>,</span>
<span id="cb18-159"><a href="#cb18-159" aria-hidden="true" tabindex="-1"></a>    <span class="at">porcentaje_logro=</span><span class="st">"porcentaje.*logro|%.*logro"</span>,</span>
<span id="cb18-160"><a href="#cb18-160" aria-hidden="true" tabindex="-1"></a>    <span class="at">categoria_global=</span><span class="st">"categor[ií]a.*resultado.*global.*estudiante"</span>,</span>
<span id="cb18-161"><a href="#cb18-161" aria-hidden="true" tabindex="-1"></a>    <span class="at">incluido_listado=</span><span class="st">"incluido.*listado"</span></span>
<span id="cb18-162"><a href="#cb18-162" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-163"><a href="#cb18-163" aria-hidden="true" tabindex="-1"></a>  rename_map <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb18-164"><a href="#cb18-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">names</span>(ren)){</span>
<span id="cb18-165"><a href="#cb18-165" aria-hidden="true" tabindex="-1"></a>    hit <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_which</span>(nms, stringr<span class="sc">::</span><span class="fu">regex</span>(ren[[k]], <span class="at">ignore_case =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-166"><a href="#cb18-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(hit)) {</span>
<span id="cb18-167"><a href="#cb18-167" aria-hidden="true" tabindex="-1"></a>      old <span class="ot">&lt;-</span> nms[hit[<span class="dv">1</span>]]; rename_map[[k]] <span class="ot">&lt;-</span> old</span>
<span id="cb18-168"><a href="#cb18-168" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-169"><a href="#cb18-169" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-170"><a href="#cb18-170" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(rename_map)) dat <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(dat, <span class="sc">!!!</span>rename_map)</span>
<span id="cb18-171"><a href="#cb18-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-172"><a href="#cb18-172" aria-hidden="true" tabindex="-1"></a>  nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb18-173"><a href="#cb18-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32a"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_a"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32a"</span> }</span>
<span id="cb18-174"><a href="#cb18-174" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32b"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_b"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32b"</span> }</span>
<span id="cb18-175"><a href="#cb18-175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_32c"</span> <span class="sc">%in%</span> nm){ hit <span class="ot">&lt;-</span> <span class="fu">which</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(nm, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"^x3_2_c"</span>, <span class="cn">TRUE</span>))); <span class="cf">if</span> (<span class="fu">length</span>(hit)) nm[hit[<span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="st">"comp_32c"</span> }</span>
<span id="cb18-176"><a href="#cb18-176" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm; nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb18-177"><a href="#cb18-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-178"><a href="#cb18-178" aria-hidden="true" tabindex="-1"></a>  idx_just <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"justificacion_no_rendicion"</span>)</span>
<span id="cb18-179"><a href="#cb18-179" aria-hidden="true" tabindex="-1"></a>  idx_32a  <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"comp_32a"</span>)</span>
<span id="cb18-180"><a href="#cb18-180" aria-hidden="true" tabindex="-1"></a>  idx_32c  <span class="ot">&lt;-</span> <span class="fu">which</span>(nm <span class="sc">==</span> <span class="st">"comp_32c"</span>)</span>
<span id="cb18-181"><a href="#cb18-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-182"><a href="#cb18-182" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx_just) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(idx_32a)){</span>
<span id="cb18-183"><a href="#cb18-183" aria-hidden="true" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="at">from =</span> idx_just <span class="sc">+</span> <span class="dv">1</span>, <span class="at">to =</span> idx_32a <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb18-184"><a href="#cb18-184" aria-hidden="true" tabindex="-1"></a>    rng <span class="ot">&lt;-</span> rng[rng <span class="sc">&gt;=</span> <span class="dv">1</span> <span class="sc">&amp;</span> rng <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)]</span>
<span id="cb18-185"><a href="#cb18-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(rng)){</span>
<span id="cb18-186"><a href="#cb18-186" aria-hidden="true" tabindex="-1"></a>      cand <span class="ot">&lt;-</span> nm[rng]; mask <span class="ot">&lt;-</span> <span class="fu">vapply</span>(dat[cand], looks_like_comp_score, <span class="fu">logical</span>(<span class="dv">1</span>))</span>
<span id="cb18-187"><a href="#cb18-187" aria-hidden="true" tabindex="-1"></a>      cand2 <span class="ot">&lt;-</span> cand[mask]</span>
<span id="cb18-188"><a href="#cb18-188" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">length</span>(cand2) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb18-189"><a href="#cb18-189" aria-hidden="true" tabindex="-1"></a>        nm[<span class="fu">match</span>(<span class="fu">tail</span>(cand2, <span class="dv">2</span>), nm)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>, <span class="st">"comp_12"</span>)</span>
<span id="cb18-190"><a href="#cb18-190" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">length</span>(cand) <span class="sc">&gt;=</span> <span class="dv">2</span>){</span>
<span id="cb18-191"><a href="#cb18-191" aria-hidden="true" tabindex="-1"></a>        nm[<span class="fu">match</span>(<span class="fu">tail</span>(cand, <span class="dv">2</span>), nm)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>, <span class="st">"comp_12"</span>)</span>
<span id="cb18-192"><a href="#cb18-192" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb18-193"><a href="#cb18-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm; nm <span class="ot">&lt;-</span> <span class="fu">names</span>(dat)</span>
<span id="cb18-194"><a href="#cb18-194" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-195"><a href="#cb18-195" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-196"><a href="#cb18-196" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(idx_32c)){</span>
<span id="cb18-197"><a href="#cb18-197" aria-hidden="true" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> idx_32c <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb18-198"><a href="#cb18-198" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_41"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"comp_41"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb18-199"><a href="#cb18-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"comp_42"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"comp_42"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb18-200"><a href="#cb18-200" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"puntaje_total"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"puntaje_total"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb18-201"><a href="#cb18-201" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"porcentaje_logro"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"porcentaje_logro"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb18-202"><a href="#cb18-202" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="st">"categoria_global"</span> <span class="sc">%in%</span> nm <span class="sc">&amp;&amp;</span> pos <span class="sc">&lt;=</span> <span class="fu">ncol</span>(dat)) { nm[pos] <span class="ot">&lt;-</span> <span class="st">"categoria_global"</span>; pos <span class="ot">&lt;-</span> pos <span class="sc">+</span> <span class="dv">1</span> }</span>
<span id="cb18-203"><a href="#cb18-203" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> nm</span>
<span id="cb18-204"><a href="#cb18-204" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-205"><a href="#cb18-205" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb18-206"><a href="#cb18-206" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-207"><a href="#cb18-207" aria-hidden="true" tabindex="-1"></a>repair_person_names <span class="ot">&lt;-</span> <span class="cf">function</span>(df){</span>
<span id="cb18-208"><a href="#cb18-208" aria-hidden="true" tabindex="-1"></a>  required <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,<span class="st">"nombres"</span>)</span>
<span id="cb18-209"><a href="#cb18-209" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(required <span class="sc">%in%</span> <span class="fu">names</span>(df))) <span class="fu">return</span>(df)</span>
<span id="cb18-210"><a href="#cb18-210" aria-hidden="true" tabindex="-1"></a>  split_full <span class="ot">&lt;-</span> <span class="cf">function</span>(txt){</span>
<span id="cb18-211"><a href="#cb18-211" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(txt) <span class="sc">||</span> txt <span class="sc">==</span> <span class="st">""</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">nombres=</span><span class="cn">NA_character_</span>, <span class="at">ap1=</span><span class="cn">NA_character_</span>, <span class="at">ap2=</span><span class="cn">NA_character_</span>))</span>
<span id="cb18-212"><a href="#cb18-212" aria-hidden="true" tabindex="-1"></a>    toks <span class="ot">&lt;-</span> <span class="fu">str_squish</span>(txt) <span class="sc">|&gt;</span> <span class="fu">str_split</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">|&gt;</span> <span class="fu">unlist</span>()</span>
<span id="cb18-213"><a href="#cb18-213" aria-hidden="true" tabindex="-1"></a>    toks <span class="ot">&lt;-</span> toks[toks <span class="sc">!=</span> <span class="st">""</span> <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(toks)]</span>
<span id="cb18-214"><a href="#cb18-214" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(toks) <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">nombres=</span><span class="cn">NA_character_</span>, <span class="at">ap1=</span><span class="cn">NA_character_</span>, <span class="at">ap2=</span><span class="cn">NA_character_</span>))</span>
<span id="cb18-215"><a href="#cb18-215" aria-hidden="true" tabindex="-1"></a>    ap2 <span class="ot">&lt;-</span> toks[<span class="fu">length</span>(toks)]; ap1 <span class="ot">&lt;-</span> toks[<span class="fu">length</span>(toks)<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb18-216"><a href="#cb18-216" aria-hidden="true" tabindex="-1"></a>    nom <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(toks) <span class="sc">&gt;</span> <span class="dv">2</span>) <span class="fu">paste</span>(toks[<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(toks)<span class="sc">-</span><span class="dv">2</span>)], <span class="at">collapse =</span> <span class="st">" "</span>) <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb18-217"><a href="#cb18-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">nombres=</span>nom, <span class="at">ap1=</span>ap1, <span class="at">ap2=</span>ap2)</span>
<span id="cb18-218"><a href="#cb18-218" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-219"><a href="#cb18-219" aria-hidden="true" tabindex="-1"></a>  need_fix <span class="ot">&lt;-</span> <span class="fu">vapply</span>(df<span class="sc">$</span>primer_apellido, <span class="cf">function</span>(x){</span>
<span id="cb18-220"><a href="#cb18-220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.na</span>(x) <span class="sc">||</span> x <span class="sc">==</span> <span class="st">""</span>) <span class="cn">FALSE</span> <span class="cf">else</span> <span class="fu">str_count</span>(x, <span class="st">"</span><span class="sc">\\</span><span class="st">S+"</span>) <span class="sc">&gt;=</span> <span class="dv">3</span></span>
<span id="cb18-221"><a href="#cb18-221" aria-hidden="true" tabindex="-1"></a>  }, <span class="fu">logical</span>(<span class="dv">1</span>))</span>
<span id="cb18-222"><a href="#cb18-222" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(need_fix)){</span>
<span id="cb18-223"><a href="#cb18-223" aria-hidden="true" tabindex="-1"></a>    fixed <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df<span class="sc">$</span>primer_apellido[need_fix], split_full)</span>
<span id="cb18-224"><a href="#cb18-224" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>nombres[need_fix]          <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"nombres"</span>)</span>
<span id="cb18-225"><a href="#cb18-225" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>primer_apellido[need_fix]  <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"ap1"</span>)</span>
<span id="cb18-226"><a href="#cb18-226" aria-hidden="true" tabindex="-1"></a>    df<span class="sc">$</span>segundo_apellido[need_fix] <span class="ot">&lt;-</span> <span class="fu">vapply</span>(fixed, <span class="st">`</span><span class="at">[[</span><span class="st">`</span>, <span class="fu">character</span>(<span class="dv">1</span>), <span class="st">"ap2"</span>)</span>
<span id="cb18-227"><a href="#cb18-227" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-228"><a href="#cb18-228" aria-hidden="true" tabindex="-1"></a>  df</span>
<span id="cb18-229"><a href="#cb18-229" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-230"><a href="#cb18-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-231"><a href="#cb18-231" aria-hidden="true" tabindex="-1"></a>parse_resultados_individuales_v2 <span class="ot">&lt;-</span> <span class="cf">function</span>(path, <span class="at">sheet =</span> <span class="cn">NULL</span>, <span class="at">compute_total =</span> <span class="cn">TRUE</span>){</span>
<span id="cb18-232"><a href="#cb18-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(path))</span>
<span id="cb18-233"><a href="#cb18-233" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(sheet)){</span>
<span id="cb18-234"><a href="#cb18-234" aria-hidden="true" tabindex="-1"></a>    shs <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">excel_sheets</span>(path)</span>
<span id="cb18-235"><a href="#cb18-235" aria-hidden="true" tabindex="-1"></a>    s_low <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_to_lower</span>(shs)</span>
<span id="cb18-236"><a href="#cb18-236" aria-hidden="true" tabindex="-1"></a>    cand <span class="ot">&lt;-</span> shs[stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"resultado"</span>) <span class="sc">&amp;</span> stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"individual"</span>)]</span>
<span id="cb18-237"><a href="#cb18-237" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(cand)) cand <span class="ot">&lt;-</span> shs[stringr<span class="sc">::</span><span class="fu">str_detect</span>(s_low, <span class="st">"individ"</span>)]</span>
<span id="cb18-238"><a href="#cb18-238" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">length</span>(cand)) cand <span class="ot">&lt;-</span> shs</span>
<span id="cb18-239"><a href="#cb18-239" aria-hidden="true" tabindex="-1"></a>    sheet <span class="ot">&lt;-</span> cand[<span class="dv">1</span>]</span>
<span id="cb18-240"><a href="#cb18-240" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Usando hoja: "</span>, sheet)</span>
<span id="cb18-241"><a href="#cb18-241" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-242"><a href="#cb18-242" aria-hidden="true" tabindex="-1"></a>  raw <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheet, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="st">"text"</span>)</span>
<span id="cb18-243"><a href="#cb18-243" aria-hidden="true" tabindex="-1"></a>  raw <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">remove_empty</span>(raw, <span class="at">which =</span> <span class="fu">c</span>(<span class="st">"rows"</span>,<span class="st">"cols"</span>))</span>
<span id="cb18-244"><a href="#cb18-244" aria-hidden="true" tabindex="-1"></a>  data_start <span class="ot">&lt;-</span> <span class="fu">guess_data_start_base</span>(raw)</span>
<span id="cb18-245"><a href="#cb18-245" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(data_start)) <span class="fu">stop</span>(<span class="st">"No pude detectar el inicio de datos (ID numérico) en la 1ª columna."</span>)</span>
<span id="cb18-246"><a href="#cb18-246" aria-hidden="true" tabindex="-1"></a>  hdr_row <span class="ot">&lt;-</span> <span class="fu">guess_header_row_base</span>(raw, data_start)</span>
<span id="cb18-247"><a href="#cb18-247" aria-hidden="true" tabindex="-1"></a>  col_nms <span class="ot">&lt;-</span> <span class="fu">make_names_from_block_base</span>(raw, hdr_row, data_start)</span>
<span id="cb18-248"><a href="#cb18-248" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">as_tibble</span>(raw[<span class="fu">seq</span>(<span class="at">from =</span> data_start, <span class="at">to =</span> <span class="fu">nrow</span>(raw)), , <span class="at">drop =</span> <span class="cn">FALSE</span>])</span>
<span id="cb18-249"><a href="#cb18-249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(dat) <span class="ot">&lt;-</span> col_nms</span>
<span id="cb18-250"><a href="#cb18-250" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">na_if</span>(.x, <span class="st">""</span>)))</span>
<span id="cb18-251"><a href="#cb18-251" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">standardize_core_names</span>(dat) <span class="sc">%&gt;%</span> <span class="fu">fallback_positionals</span>()</span>
<span id="cb18-252"><a href="#cb18-252" aria-hidden="true" tabindex="-1"></a>  id_candidates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"datos_de_estudiantes_de_la_cohorte"</span>, <span class="st">"rut"</span>, <span class="st">"id_estudiante"</span>, <span class="st">"id"</span>, <span class="fu">names</span>(dat)[<span class="dv">1</span>])</span>
<span id="cb18-253"><a href="#cb18-253" aria-hidden="true" tabindex="-1"></a>  id_col <span class="ot">&lt;-</span> <span class="fu">first_existing_col_base</span>(dat, id_candidates)</span>
<span id="cb18-254"><a href="#cb18-254" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id_estudiante =</span> <span class="fu">as.character</span>(.data[[id_col]]))</span>
<span id="cb18-255"><a href="#cb18-255" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">repair_person_names</span>(dat)</span>
<span id="cb18-256"><a href="#cb18-256" aria-hidden="true" tabindex="-1"></a>  has_3 <span class="ot">&lt;-</span> <span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"nombres"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(dat))</span>
<span id="cb18-257"><a href="#cb18-257" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb18-258"><a href="#cb18-258" aria-hidden="true" tabindex="-1"></a>    <span class="at">nombre_completo =</span> <span class="cf">if</span> (has_3) stringr<span class="sc">::</span><span class="fu">str_squish</span>(<span class="fu">paste</span>(nombres, primer_apellido, segundo_apellido))</span>
<span id="cb18-259"><a href="#cb18-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cn">NA_character_</span></span>
<span id="cb18-260"><a href="#cb18-260" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-261"><a href="#cb18-261" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb18-262"><a href="#cb18-262" aria-hidden="true" tabindex="-1"></a>  rindio_from_fecha <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"fecha_rendicion"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)) {</span>
<span id="cb18-263"><a href="#cb18-263" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>fecha_rendicion), <span class="st">""</span>, dat<span class="sc">$</span>fecha_rendicion))</span>
<span id="cb18-264"><a href="#cb18-264" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"no</span><span class="sc">\\</span><span class="st">s*rendida"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">0</span>L,</span>
<span id="cb18-265"><a href="#cb18-265" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"rendida"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>L, <span class="cn">NA_integer_</span>))</span>
<span id="cb18-266"><a href="#cb18-266" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="fu">rep</span>(<span class="cn">NA_integer_</span>, n)</span>
<span id="cb18-267"><a href="#cb18-267" aria-hidden="true" tabindex="-1"></a>  rindio_from_estat <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="st">"estatus_rendicion"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)) {</span>
<span id="cb18-268"><a href="#cb18-268" aria-hidden="true" tabindex="-1"></a>    tmp <span class="ot">&lt;-</span> <span class="fu">tolower</span>(<span class="fu">ifelse</span>(<span class="fu">is.na</span>(dat<span class="sc">$</span>estatus_rendicion), <span class="st">""</span>, dat<span class="sc">$</span>estatus_rendicion))</span>
<span id="cb18-269"><a href="#cb18-269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"no</span><span class="sc">\\</span><span class="st">s*rend"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">0</span>L,</span>
<span id="cb18-270"><a href="#cb18-270" aria-hidden="true" tabindex="-1"></a>           <span class="fu">ifelse</span>(stringr<span class="sc">::</span><span class="fu">str_detect</span>(tmp, stringr<span class="sc">::</span><span class="fu">regex</span>(<span class="st">"rend"</span>, <span class="at">ignore_case =</span> <span class="cn">TRUE</span>)), <span class="dv">1</span>L, <span class="cn">NA_integer_</span>))</span>
<span id="cb18-271"><a href="#cb18-271" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="fu">rep</span>(<span class="cn">NA_integer_</span>, n)</span>
<span id="cb18-272"><a href="#cb18-272" aria-hidden="true" tabindex="-1"></a>  dat<span class="sc">$</span>rindio <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(rindio_from_fecha, rindio_from_estat)</span>
<span id="cb18-273"><a href="#cb18-273" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">standardize_competencias</span>(dat)</span>
<span id="cb18-274"><a href="#cb18-274" aria-hidden="true" tabindex="-1"></a>  comp_guess <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"comp_11"</span>,<span class="st">"comp_12"</span>,<span class="st">"comp_32a"</span>,<span class="st">"comp_32b"</span>,<span class="st">"comp_32c"</span>,<span class="st">"comp_41"</span>,<span class="st">"comp_42"</span>)</span>
<span id="cb18-275"><a href="#cb18-275" aria-hidden="true" tabindex="-1"></a>  comp_cols <span class="ot">&lt;&lt;-</span> <span class="fu">intersect</span>(<span class="fu">names</span>(dat), comp_guess)</span>
<span id="cb18-276"><a href="#cb18-276" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(comp_cols)){</span>
<span id="cb18-277"><a href="#cb18-277" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols),</span>
<span id="cb18-278"><a href="#cb18-278" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(.x)))))</span>
<span id="cb18-279"><a href="#cb18-279" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-280"><a href="#cb18-280" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"puntaje_total"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)){</span>
<span id="cb18-281"><a href="#cb18-281" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">puntaje_total =</span> <span class="fu">suppressWarnings</span>(readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(puntaje_total))))</span>
<span id="cb18-282"><a href="#cb18-282" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (compute_total <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(comp_cols)){</span>
<span id="cb18-283"><a href="#cb18-283" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">puntaje_total =</span> <span class="fu">rowSums</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols)), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-284"><a href="#cb18-284" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-285"><a href="#cb18-285" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="st">"porcentaje_logro"</span> <span class="sc">%in%</span> <span class="fu">names</span>(dat)){</span>
<span id="cb18-286"><a href="#cb18-286" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">porcentaje_logro =</span> readr<span class="sc">::</span><span class="fu">parse_number</span>(<span class="fu">as.character</span>(porcentaje_logro)))</span>
<span id="cb18-287"><a href="#cb18-287" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-288"><a href="#cb18-288" aria-hidden="true" tabindex="-1"></a>  dat</span>
<span id="cb18-289"><a href="#cb18-289" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-290"><a href="#cb18-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-291"><a href="#cb18-291" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">parse_resultados_individuales_v2</span>(archivo)</span>
<span id="cb18-292"><a href="#cb18-292" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-293"><a href="#cb18-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Normaliza "NR" a NA</span></span>
<span id="cb18-294"><a href="#cb18-294" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(.x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"NR"</span>,<span class="st">"N R"</span>,<span class="st">"nr"</span>,<span class="st">"n r"</span>), <span class="cn">NA</span>, .x)))</span>
<span id="cb18-295"><a href="#cb18-295" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-296"><a href="#cb18-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-297"><a href="#cb18-297" aria-hidden="true" tabindex="-1"></a><span class="in">```{r glimpse}</span></span>
<span id="cb18-298"><a href="#cb18-298" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span>
<span id="cb18-299"><a href="#cb18-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-300"><a href="#cb18-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-301"><a href="#cb18-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## 2) KPIs, tabla de muestra y reporte automático</span></span>
<span id="cb18-302"><a href="#cb18-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-303"><a href="#cb18-303" aria-hidden="true" tabindex="-1"></a><span class="in">```{r kpis}</span></span>
<span id="cb18-304"><a href="#cb18-304" aria-hidden="true" tabindex="-1"></a>n_est   <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dat)</span>
<span id="cb18-305"><a href="#cb18-305" aria-hidden="true" tabindex="-1"></a>p_rinde <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>rindio <span class="sc">%in%</span> <span class="dv">1</span>L, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-306"><a href="#cb18-306" aria-hidden="true" tabindex="-1"></a>m_pt    <span class="ot">&lt;-</span> <span class="fu">mean</span>(dat<span class="sc">$</span>puntaje_total, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb18-307"><a href="#cb18-307" aria-hidden="true" tabindex="-1"></a>p50_pt  <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">quantile</span>(dat<span class="sc">$</span>puntaje_total, <span class="fl">0.5</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb18-308"><a href="#cb18-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-309"><a href="#cb18-309" aria-hidden="true" tabindex="-1"></a><span class="co"># Promedios por competencia usando nombres de columna tal cual (sin labels)</span></span>
<span id="cb18-310"><a href="#cb18-310" aria-hidden="true" tabindex="-1"></a>prom_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb18-311"><a href="#cb18-311" aria-hidden="true" tabindex="-1"></a>  dat <span class="sc">|&gt;</span></span>
<span id="cb18-312"><a href="#cb18-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols), <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb18-313"><a href="#cb18-313" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"prom"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-314"><a href="#cb18-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">match</span>(competencia, comp_cols))</span>
<span id="cb18-315"><a href="#cb18-315" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="fu">tibble</span>(<span class="at">competencia =</span> <span class="fu">character</span>(), <span class="at">prom =</span> <span class="fu">numeric</span>())</span>
<span id="cb18-316"><a href="#cb18-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-317"><a href="#cb18-317" aria-hidden="true" tabindex="-1"></a>top_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(prom_comp)) prom_comp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(prom)) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb18-318"><a href="#cb18-318" aria-hidden="true" tabindex="-1"></a>bot_comp <span class="ot">&lt;-</span> <span class="cf">if</span> (<span class="fu">nrow</span>(prom_comp)) prom_comp <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(prom) <span class="sc">%&gt;%</span> <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">1</span>)        <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb18-319"><a href="#cb18-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-320"><a href="#cb18-320" aria-hidden="true" tabindex="-1"></a>htmltools<span class="sc">::</span><span class="fu">HTML</span>(glue<span class="sc">::</span><span class="fu">glue</span>(</span>
<span id="cb18-321"><a href="#cb18-321" aria-hidden="true" tabindex="-1"></a>  <span class="st">"&lt;p&gt;&lt;b&gt;Resumen ejecutivo&lt;/b&gt;&lt;/p&gt;</span></span>
<span id="cb18-322"><a href="#cb18-322" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;ul&gt;</span></span>
<span id="cb18-323"><a href="#cb18-323" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;N estudiantes:&lt;/b&gt; {n_est}&lt;/li&gt;</span></span>
<span id="cb18-324"><a href="#cb18-324" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;% Rendición:&lt;/b&gt; {scales::percent(p_rinde, accuracy = 0.1)}&lt;/li&gt;</span></span>
<span id="cb18-325"><a href="#cb18-325" aria-hidden="true" tabindex="-1"></a><span class="st">    &lt;li&gt;&lt;b&gt;Puntaje total&lt;/b&gt; — media: {round(m_pt,2)}, mediana: {round(p50_pt,2)}&lt;/li&gt;</span></span>
<span id="cb18-326"><a href="#cb18-326" aria-hidden="true" tabindex="-1"></a><span class="st">    {if (nrow(prom_comp)) glue::glue('&lt;li&gt;&lt;b&gt;Mayor promedio:&lt;/b&gt; {top_comp$competencia} ({round(top_comp$prom,2)})&lt;/li&gt;') else ''}</span></span>
<span id="cb18-327"><a href="#cb18-327" aria-hidden="true" tabindex="-1"></a><span class="st">    {if (nrow(prom_comp)) glue::glue('&lt;li&gt;&lt;b&gt;Menor promedio:&lt;/b&gt; {bot_comp$competencia} ({round(bot_comp$prom,2)})&lt;/li&gt;') else ''}</span></span>
<span id="cb18-328"><a href="#cb18-328" aria-hidden="true" tabindex="-1"></a><span class="st">  &lt;/ul&gt;"</span></span>
<span id="cb18-329"><a href="#cb18-329" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb18-330"><a href="#cb18-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-331"><a href="#cb18-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-332"><a href="#cb18-332" aria-hidden="true" tabindex="-1"></a><span class="in">```{r tabla_muestra}</span></span>
<span id="cb18-333"><a href="#cb18-333" aria-hidden="true" tabindex="-1"></a>cols_show <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rut"</span>,<span class="st">"dv"</span>,<span class="st">"nombres"</span>,<span class="st">"primer_apellido"</span>,<span class="st">"segundo_apellido"</span>,</span>
<span id="cb18-334"><a href="#cb18-334" aria-hidden="true" tabindex="-1"></a>               <span class="st">"puntaje_total"</span>,<span class="st">"porcentaje_logro"</span>,<span class="st">"categoria_global"</span>,<span class="st">"rindio"</span>)</span>
<span id="cb18-335"><a href="#cb18-335" aria-hidden="true" tabindex="-1"></a>cols_show <span class="ot">&lt;-</span> <span class="fu">intersect</span>(cols_show, <span class="fu">names</span>(dat))</span>
<span id="cb18-336"><a href="#cb18-336" aria-hidden="true" tabindex="-1"></a>tbl <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(cols_show)) <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">15</span>)</span>
<span id="cb18-337"><a href="#cb18-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-338"><a href="#cb18-338" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb18-339"><a href="#cb18-339" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"table"</span>,</span>
<span id="cb18-340"><a href="#cb18-340" aria-hidden="true" tabindex="-1"></a>  <span class="at">header =</span> <span class="fu">list</span>(<span class="at">values =</span> <span class="fu">names</span>(tbl), <span class="at">align =</span> <span class="st">"center"</span>,</span>
<span id="cb18-341"><a href="#cb18-341" aria-hidden="true" tabindex="-1"></a>                <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">color =</span> brand_accent), <span class="at">font =</span> <span class="fu">list</span>(<span class="at">color =</span> <span class="st">"white"</span>)),</span>
<span id="cb18-342"><a href="#cb18-342" aria-hidden="true" tabindex="-1"></a>  <span class="at">cells  =</span> <span class="fu">list</span>(<span class="at">values =</span> <span class="fu">lapply</span>(tbl, identity), <span class="at">align =</span> <span class="st">"left"</span>)</span>
<span id="cb18-343"><a href="#cb18-343" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb18-344"><a href="#cb18-344" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"Muestra de registros (15)"</span>)</span>
<span id="cb18-345"><a href="#cb18-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-346"><a href="#cb18-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-347"><a href="#cb18-347" aria-hidden="true" tabindex="-1"></a><span class="fu">## 3) Visualizaciones (Plotly)</span></span>
<span id="cb18-348"><a href="#cb18-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-349"><a href="#cb18-349" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.1 Histograma puntaje total</span></span>
<span id="cb18-350"><a href="#cb18-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-351"><a href="#cb18-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_puntaje}</span></span>
<span id="cb18-352"><a href="#cb18-352" aria-hidden="true" tabindex="-1"></a>dat_p <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(puntaje_total))</span>
<span id="cb18-353"><a href="#cb18-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-354"><a href="#cb18-354" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb18-355"><a href="#cb18-355" aria-hidden="true" tabindex="-1"></a>  dat_p,</span>
<span id="cb18-356"><a href="#cb18-356" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>puntaje_total,</span>
<span id="cb18-357"><a href="#cb18-357" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"histogram"</span>,</span>
<span id="cb18-358"><a href="#cb18-358" aria-hidden="true" tabindex="-1"></a>  <span class="at">nbinsx =</span> <span class="dv">25</span>,</span>
<span id="cb18-359"><a href="#cb18-359" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb18-360"><a href="#cb18-360" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb18-361"><a href="#cb18-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb18-362"><a href="#cb18-362" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución puntaje_total"</span>,</span>
<span id="cb18-363"><a href="#cb18-363" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"puntaje_total"</span>),</span>
<span id="cb18-364"><a href="#cb18-364" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Frecuencia"</span>)</span>
<span id="cb18-365"><a href="#cb18-365" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-366"><a href="#cb18-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-367"><a href="#cb18-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-368"><a href="#cb18-368" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-369"><a href="#cb18-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-370"><a href="#cb18-370" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.2 Barras por categoría_global</span></span>
<span id="cb18-371"><a href="#cb18-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-372"><a href="#cb18-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_cat}</span></span>
<span id="cb18-373"><a href="#cb18-373" aria-hidden="true" tabindex="-1"></a>cat_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-374"><a href="#cb18-374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">categoria_global =</span> <span class="fu">fct_infreq</span>(categoria_global) <span class="sc">|&gt;</span> <span class="fu">fct_rev</span>()) <span class="sc">|&gt;</span></span>
<span id="cb18-375"><a href="#cb18-375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(categoria_global, <span class="at">name =</span> <span class="st">"n"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-376"><a href="#cb18-376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(categoria_global))</span>
<span id="cb18-377"><a href="#cb18-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-378"><a href="#cb18-378" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb18-379"><a href="#cb18-379" aria-hidden="true" tabindex="-1"></a>  cat_df,</span>
<span id="cb18-380"><a href="#cb18-380" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="sc">~</span>categoria_global,</span>
<span id="cb18-381"><a href="#cb18-381" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="sc">~</span>n,</span>
<span id="cb18-382"><a href="#cb18-382" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"bar"</span>,</span>
<span id="cb18-383"><a href="#cb18-383" aria-hidden="true" tabindex="-1"></a>  <span class="at">orientation =</span> <span class="st">"h"</span></span>
<span id="cb18-384"><a href="#cb18-384" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb18-385"><a href="#cb18-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb18-386"><a href="#cb18-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribución por categoria_global"</span>,</span>
<span id="cb18-387"><a href="#cb18-387" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"N"</span>),</span>
<span id="cb18-388"><a href="#cb18-388" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>)</span>
<span id="cb18-389"><a href="#cb18-389" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-390"><a href="#cb18-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-391"><a href="#cb18-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-392"><a href="#cb18-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-393"><a href="#cb18-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-394"><a href="#cb18-394" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.3 Boxplots por competencia (0–3)</span></span>
<span id="cb18-395"><a href="#cb18-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-396"><a href="#cb18-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_box}</span></span>
<span id="cb18-397"><a href="#cb18-397" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a>  dat_long <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(comp_cols), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"nota"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nota)) <span class="sc">|&gt;</span></span>
<span id="cb18-401"><a href="#cb18-401" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols))</span>
<span id="cb18-402"><a href="#cb18-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>() <span class="sc">|&gt;</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_trace</span>(</span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> dat_long,</span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="sc">~</span>competencia, <span class="at">y =</span> <span class="sc">~</span>nota,</span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a>      <span class="at">type =</span> <span class="st">"box"</span>,</span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a>      <span class="at">boxpoints =</span> <span class="st">"outliers"</span>,</span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a>      <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">opacity =</span> <span class="fl">0.6</span>),</span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a>      <span class="at">line =</span> <span class="fu">list</span>(<span class="at">color =</span> brand_text)</span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribución por competencia"</span>,</span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Nota (0–3)"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">dtick =</span> <span class="dv">1</span>)</span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-419"><a href="#cb18-419" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-420"><a href="#cb18-420" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">"&lt;em&gt;No se detectaron columnas de competencias.&lt;/em&gt;"</span>)</span>
<span id="cb18-421"><a href="#cb18-421" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-422"><a href="#cb18-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-423"><a href="#cb18-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-424"><a href="#cb18-424" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.4 % de niveles (0–3) por competencia</span></span>
<span id="cb18-425"><a href="#cb18-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-426"><a href="#cb18-426" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_stack}</span></span>
<span id="cb18-427"><a href="#cb18-427" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb18-428"><a href="#cb18-428" aria-hidden="true" tabindex="-1"></a>  dist_comp <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-429"><a href="#cb18-429" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">all_of</span>(comp_cols), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"nota"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-430"><a href="#cb18-430" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols),</span>
<span id="cb18-431"><a href="#cb18-431" aria-hidden="true" tabindex="-1"></a>           <span class="at">nota =</span> <span class="fu">factor</span>(nota, <span class="at">levels =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<span id="cb18-432"><a href="#cb18-432" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(competencia, nota, <span class="at">.drop =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-433"><a href="#cb18-433" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(competencia) <span class="sc">|&gt;</span></span>
<span id="cb18-434"><a href="#cb18-434" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb18-435"><a href="#cb18-435" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb18-436"><a href="#cb18-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-437"><a href="#cb18-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb18-438"><a href="#cb18-438" aria-hidden="true" tabindex="-1"></a>    dist_comp,</span>
<span id="cb18-439"><a href="#cb18-439" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>competencia,</span>
<span id="cb18-440"><a href="#cb18-440" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">~</span>prop,</span>
<span id="cb18-441"><a href="#cb18-441" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>nota,</span>
<span id="cb18-442"><a href="#cb18-442" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"bar"</span></span>
<span id="cb18-443"><a href="#cb18-443" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-444"><a href="#cb18-444" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb18-445"><a href="#cb18-445" aria-hidden="true" tabindex="-1"></a>      <span class="at">barmode =</span> <span class="st">"stack"</span>,</span>
<span id="cb18-446"><a href="#cb18-446" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Distribución de niveles por competencia"</span>,</span>
<span id="cb18-447"><a href="#cb18-447" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb18-448"><a href="#cb18-448" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"% dentro de competencia"</span>, <span class="at">tickformat =</span> <span class="st">".0%"</span>)</span>
<span id="cb18-449"><a href="#cb18-449" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-450"><a href="#cb18-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-451"><a href="#cb18-451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-452"><a href="#cb18-452" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-453"><a href="#cb18-453" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">""</span>)</span>
<span id="cb18-454"><a href="#cb18-454" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-455"><a href="#cb18-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-456"><a href="#cb18-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-457"><a href="#cb18-457" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.5 Dispersión: comp_11 vs comp_12</span></span>
<span id="cb18-458"><a href="#cb18-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-459"><a href="#cb18-459" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_scatter}</span></span>
<span id="cb18-460"><a href="#cb18-460" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">c</span>(<span class="st">"comp_11"</span>,<span class="st">"comp_12"</span>) <span class="sc">%in%</span> <span class="fu">names</span>(dat))) {</span>
<span id="cb18-461"><a href="#cb18-461" aria-hidden="true" tabindex="-1"></a>  scat_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-462"><a href="#cb18-462" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(comp_11), <span class="sc">!</span><span class="fu">is.na</span>(comp_12)) <span class="sc">|&gt;</span></span>
<span id="cb18-463"><a href="#cb18-463" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb18-464"><a href="#cb18-464" aria-hidden="true" tabindex="-1"></a>      <span class="at">j11 =</span> comp_11 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.05</span>),</span>
<span id="cb18-465"><a href="#cb18-465" aria-hidden="true" tabindex="-1"></a>      <span class="at">j12 =</span> comp_12 <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="dv">0</span>, <span class="fl">0.05</span>),</span>
<span id="cb18-466"><a href="#cb18-466" aria-hidden="true" tabindex="-1"></a>      <span class="at">hover =</span> <span class="fu">paste0</span>(</span>
<span id="cb18-467"><a href="#cb18-467" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;b&gt;"</span>, <span class="fu">ifelse</span>(<span class="fu">is.na</span>(nombre_completo), <span class="st">"(sin nombre)"</span>, nombre_completo), <span class="st">"&lt;/b&gt;"</span>,</span>
<span id="cb18-468"><a href="#cb18-468" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;comp_11: "</span>, comp_11,</span>
<span id="cb18-469"><a href="#cb18-469" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;comp_12: "</span>, comp_12,</span>
<span id="cb18-470"><a href="#cb18-470" aria-hidden="true" tabindex="-1"></a>        <span class="st">"&lt;br&gt;categoria_global: "</span>, categoria_global</span>
<span id="cb18-471"><a href="#cb18-471" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb18-472"><a href="#cb18-472" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-473"><a href="#cb18-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-474"><a href="#cb18-474" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb18-475"><a href="#cb18-475" aria-hidden="true" tabindex="-1"></a>    scat_df,</span>
<span id="cb18-476"><a href="#cb18-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="sc">~</span>j11, <span class="at">y =</span> <span class="sc">~</span>j12,</span>
<span id="cb18-477"><a href="#cb18-477" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatter"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb18-478"><a href="#cb18-478" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="sc">~</span>categoria_global,</span>
<span id="cb18-479"><a href="#cb18-479" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="sc">~</span>hover, <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb18-480"><a href="#cb18-480" aria-hidden="true" tabindex="-1"></a>    <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">7</span>, <span class="at">opacity =</span> <span class="fl">0.85</span>, <span class="at">line =</span> <span class="fu">list</span>(<span class="at">width =</span> <span class="dv">0</span>))</span>
<span id="cb18-481"><a href="#cb18-481" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-482"><a href="#cb18-482" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb18-483"><a href="#cb18-483" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"comp_11 vs comp_12"</span>,</span>
<span id="cb18-484"><a href="#cb18-484" aria-hidden="true" tabindex="-1"></a>      <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"comp_11"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">3.1</span>), <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb18-485"><a href="#cb18-485" aria-hidden="true" tabindex="-1"></a>      <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"comp_12"</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">3.1</span>), <span class="at">dtick =</span> <span class="dv">1</span>),</span>
<span id="cb18-486"><a href="#cb18-486" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend =</span> <span class="fu">list</span>(<span class="at">orientation =</span> <span class="st">"h"</span>, <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.2</span>)</span>
<span id="cb18-487"><a href="#cb18-487" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-488"><a href="#cb18-488" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-489"><a href="#cb18-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-490"><a href="#cb18-490" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-491"><a href="#cb18-491" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">"&lt;em&gt;No están presentes simultáneamente comp_11 y comp_12.&lt;/em&gt;"</span>)</span>
<span id="cb18-492"><a href="#cb18-492" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-493"><a href="#cb18-493" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-494"><a href="#cb18-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-495"><a href="#cb18-495" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.6 Radar: promedio por competencia (0–3)</span></span>
<span id="cb18-496"><a href="#cb18-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-497"><a href="#cb18-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_radar}</span></span>
<span id="cb18-498"><a href="#cb18-498" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(comp_cols)) {</span>
<span id="cb18-499"><a href="#cb18-499" aria-hidden="true" tabindex="-1"></a>  avg_comp <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-500"><a href="#cb18-500" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(comp_cols), <span class="sc">~</span><span class="fu">mean</span>(.x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))) <span class="sc">|&gt;</span></span>
<span id="cb18-501"><a href="#cb18-501" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"competencia"</span>, <span class="at">values_to =</span> <span class="st">"prom"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-502"><a href="#cb18-502" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">competencia =</span> <span class="fu">factor</span>(competencia, <span class="at">levels =</span> comp_cols)) <span class="sc">|&gt;</span></span>
<span id="cb18-503"><a href="#cb18-503" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(competencia)</span>
<span id="cb18-504"><a href="#cb18-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-505"><a href="#cb18-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_ly</span>(</span>
<span id="cb18-506"><a href="#cb18-506" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"scatterpolar"</span>,</span>
<span id="cb18-507"><a href="#cb18-507" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> avg_comp<span class="sc">$</span>prom,</span>
<span id="cb18-508"><a href="#cb18-508" aria-hidden="true" tabindex="-1"></a>    <span class="at">theta =</span> avg_comp<span class="sc">$</span>competencia,</span>
<span id="cb18-509"><a href="#cb18-509" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"toself"</span>,</span>
<span id="cb18-510"><a href="#cb18-510" aria-hidden="true" tabindex="-1"></a>    <span class="at">mode =</span> <span class="st">"lines+markers"</span>,</span>
<span id="cb18-511"><a href="#cb18-511" aria-hidden="true" tabindex="-1"></a>    <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb18-512"><a href="#cb18-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">paste0</span>(avg_comp<span class="sc">$</span>competencia, <span class="st">": "</span>, <span class="fu">round</span>(avg_comp<span class="sc">$</span>prom, <span class="dv">2</span>))</span>
<span id="cb18-513"><a href="#cb18-513" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-514"><a href="#cb18-514" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(</span>
<span id="cb18-515"><a href="#cb18-515" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Promedio por competencia"</span>,</span>
<span id="cb18-516"><a href="#cb18-516" aria-hidden="true" tabindex="-1"></a>      <span class="at">polar =</span> <span class="fu">list</span>(<span class="at">radialaxis =</span> <span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">TRUE</span>, <span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>), <span class="at">tick0 =</span> <span class="dv">0</span>, <span class="at">dtick =</span> <span class="dv">1</span>))</span>
<span id="cb18-517"><a href="#cb18-517" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb18-518"><a href="#cb18-518" aria-hidden="true" tabindex="-1"></a>    <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-519"><a href="#cb18-519" aria-hidden="true" tabindex="-1"></a>    <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-520"><a href="#cb18-520" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb18-521"><a href="#cb18-521" aria-hidden="true" tabindex="-1"></a>  htmltools<span class="sc">::</span><span class="fu">HTML</span>(<span class="st">""</span>)</span>
<span id="cb18-522"><a href="#cb18-522" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-523"><a href="#cb18-523" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-524"><a href="#cb18-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-525"><a href="#cb18-525" aria-hidden="true" tabindex="-1"></a><span class="fu">### 3.7 % de rendición</span></span>
<span id="cb18-526"><a href="#cb18-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-527"><a href="#cb18-527" aria-hidden="true" tabindex="-1"></a><span class="in">```{r g_rinde}</span></span>
<span id="cb18-528"><a href="#cb18-528" aria-hidden="true" tabindex="-1"></a>rin_df <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span></span>
<span id="cb18-529"><a href="#cb18-529" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rindio =</span> <span class="fu">factor</span>(<span class="fu">ifelse</span>(rindio <span class="sc">%in%</span> <span class="dv">1</span>L, <span class="st">"Rindió"</span>, <span class="st">"No rindió"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb18-530"><a href="#cb18-530" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(rindio) <span class="sc">|&gt;</span></span>
<span id="cb18-531"><a href="#cb18-531" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> n<span class="sc">/</span><span class="fu">sum</span>(n))</span>
<span id="cb18-532"><a href="#cb18-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-533"><a href="#cb18-533" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(rin_df, <span class="at">x =</span> <span class="sc">~</span>rindio, <span class="at">y =</span> <span class="sc">~</span>prop, <span class="at">type =</span> <span class="st">"bar"</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-534"><a href="#cb18-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb18-535"><a href="#cb18-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"% de rendición"</span>,</span>
<span id="cb18-536"><a href="#cb18-536" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">""</span>),</span>
<span id="cb18-537"><a href="#cb18-537" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"Porcentaje"</span>, <span class="at">tickformat =</span> <span class="st">".0%"</span>)</span>
<span id="cb18-538"><a href="#cb18-538" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb18-539"><a href="#cb18-539" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(plotly_brand) <span class="sc">|&gt;</span></span>
<span id="cb18-540"><a href="#cb18-540" aria-hidden="true" tabindex="-1"></a>  <span class="fu">config</span>(<span class="at">displaylogo =</span> <span class="cn">FALSE</span>, <span class="at">modeBarButtonsToRemove =</span> <span class="fu">c</span>(<span class="st">"lasso2d"</span>,<span class="st">"select2d"</span>))</span>
<span id="cb18-541"><a href="#cb18-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb18-542"><a href="#cb18-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-543"><a href="#cb18-543" aria-hidden="true" tabindex="-1"></a><span class="fu">## 4) Notas</span></span>
<span id="cb18-544"><a href="#cb18-544" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-545"><a href="#cb18-545" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Los nombres de ejes/leyendas usan **directamente los nombres de columnas** (<span class="in">`comp_11`</span>, <span class="in">`comp_12`</span>, etc.).</span>
<span id="cb18-546"><a href="#cb18-546" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Si cambian nombres de columnas en otro Excel, el parser intenta normalizar; si no existen, esas gráficas se omiten con un aviso breve.</span>
<span id="cb18-547"><a href="#cb18-547" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




<script src="reporte_prueba_files/libs/quarto-html/zenscroll-min.js"></script>
</body></html>